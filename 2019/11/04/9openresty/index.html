<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="study notes,">





  <link rel="alternate" href="/atom.xml" title="AlexiXiang‚Äôs Blog" type="application/atom+xml">






<meta name="description" content="Áî±‰∫éÂÖ¨Âè∏CÁ´Ø‰∏öÂä°ÁöÑ Nginx Ê°ÜÊû∂‰ΩøÁî®ÁöÑÊòØOpenResty„ÄÇÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†Â≠¶‰π†‰∫Ü Nginx Âü∫Á°ÄÁü•ËØÜÂêéÔºåÂÜ≥ÂÆöÂÜçÂ≠¶‰π†‰∏Ä‰∏ã Lua Âíå OpenResty„ÄÇÊú¨ÊñáËÆ∞ÂΩï‰∫ÜËá™Â∑±Â≠¶‰π†ËøáÁ®ã‰∏≠ÁöÑ‰∏Ä‰∫õÁ¨îËÆ∞ÂíåÊÄªÁªìÔºåÂ∞ùËØï‰∫ÜOpenRestyÂú®Êú¨Âú∞Êê≠Âª∫ÁÆÄÂçïÁöÑAPI ServerÊ°ÜÊû∂ÁöÑdemoÔºåÂåÖÊã¨Â§ÑÁêÜÊé•Âè£Ë∑ØÁî±‰ª•ÂèäÊìç‰Ωú Redis ÁöÑÁöÑÊµÅÁ®ã„ÄÇÈÄöËøáÂ≠¶‰π†ÔºåÊú™Â∞ÜÊù•ÂèØËÉΩÊ∂âÂèäÂà∞OpenRestyÁöÑÂºÄÂèëÂÅö‰∏Ä‰∫õÂáÜÂ§á„ÄÇ">
<meta name="keywords" content="study notes">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenResty &amp;&amp; LuaÂ≠¶‰π†Á¨îËÆ∞ üëÄ">
<meta property="og:url" content="http://alexixyc.cn/2019/11/04/9openresty/index.html">
<meta property="og:site_name" content="AlexiXiang‚Äôs Blog">
<meta property="og:description" content="Áî±‰∫éÂÖ¨Âè∏CÁ´Ø‰∏öÂä°ÁöÑ Nginx Ê°ÜÊû∂‰ΩøÁî®ÁöÑÊòØOpenResty„ÄÇÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†Â≠¶‰π†‰∫Ü Nginx Âü∫Á°ÄÁü•ËØÜÂêéÔºåÂÜ≥ÂÆöÂÜçÂ≠¶‰π†‰∏Ä‰∏ã Lua Âíå OpenResty„ÄÇÊú¨ÊñáËÆ∞ÂΩï‰∫ÜËá™Â∑±Â≠¶‰π†ËøáÁ®ã‰∏≠ÁöÑ‰∏Ä‰∫õÁ¨îËÆ∞ÂíåÊÄªÁªìÔºåÂ∞ùËØï‰∫ÜOpenRestyÂú®Êú¨Âú∞Êê≠Âª∫ÁÆÄÂçïÁöÑAPI ServerÊ°ÜÊû∂ÁöÑdemoÔºåÂåÖÊã¨Â§ÑÁêÜÊé•Âè£Ë∑ØÁî±‰ª•ÂèäÊìç‰Ωú Redis ÁöÑÁöÑÊµÅÁ®ã„ÄÇÈÄöËøáÂ≠¶‰π†ÔºåÊú™Â∞ÜÊù•ÂèØËÉΩÊ∂âÂèäÂà∞OpenRestyÁöÑÂºÄÂèëÂÅö‰∏Ä‰∫õÂáÜÂ§á„ÄÇ">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://alexixyc.cn/2019/11/04/9openresty/openresty.svg">
<meta property="og:updated_time" content="2019-11-09T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenResty &amp;&amp; LuaÂ≠¶‰π†Á¨îËÆ∞ üëÄ">
<meta name="twitter:description" content="Áî±‰∫éÂÖ¨Âè∏CÁ´Ø‰∏öÂä°ÁöÑ Nginx Ê°ÜÊû∂‰ΩøÁî®ÁöÑÊòØOpenResty„ÄÇÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†Â≠¶‰π†‰∫Ü Nginx Âü∫Á°ÄÁü•ËØÜÂêéÔºåÂÜ≥ÂÆöÂÜçÂ≠¶‰π†‰∏Ä‰∏ã Lua Âíå OpenResty„ÄÇÊú¨ÊñáËÆ∞ÂΩï‰∫ÜËá™Â∑±Â≠¶‰π†ËøáÁ®ã‰∏≠ÁöÑ‰∏Ä‰∫õÁ¨îËÆ∞ÂíåÊÄªÁªìÔºåÂ∞ùËØï‰∫ÜOpenRestyÂú®Êú¨Âú∞Êê≠Âª∫ÁÆÄÂçïÁöÑAPI ServerÊ°ÜÊû∂ÁöÑdemoÔºåÂåÖÊã¨Â§ÑÁêÜÊé•Âè£Ë∑ØÁî±‰ª•ÂèäÊìç‰Ωú Redis ÁöÑÁöÑÊµÅÁ®ã„ÄÇÈÄöËøáÂ≠¶‰π†ÔºåÊú™Â∞ÜÊù•ÂèØËÉΩÊ∂âÂèäÂà∞OpenRestyÁöÑÂºÄÂèëÂÅö‰∏Ä‰∫õÂáÜÂ§á„ÄÇ">
<meta name="twitter:image" content="http://alexixyc.cn/2019/11/04/9openresty/openresty.svg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Âçö‰∏ª'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://alexixyc.cn/2019/11/04/9openresty/">





  <title>OpenResty && LuaÂ≠¶‰π†Á¨îËÆ∞ üëÄ | AlexiXiang‚Äôs Blog</title>
  








<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AlexiXiang‚Äôs Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            È¶ñÈ°µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            ÂΩíÊ°£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            ÂÖ≥‰∫é
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://alexixyc.cn/2019/11/04/9openresty/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AlexiXiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlexiXiang‚Äôs Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">OpenResty && LuaÂ≠¶‰π†Á¨îËÆ∞ üëÄ</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂèëË°®‰∫é</span>
              
              <time title="ÂàõÂª∫‰∫é" itemprop="dateCreated datePublished" datetime="2019-11-04T00:00:00+08:00">
                2019-11-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Êõ¥Êñ∞‰∫é&#58;</span>
              
              <time title="Êõ¥Êñ∞‰∫é" itemprop="dateModified" datetime="2019-11-10T00:00:00+08:00">
                2019-11-10
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂàÜÁ±ª‰∫é</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/study-notes/" itemprop="url" rel="index">
                    <span itemprop="name">study notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Â≠óÊï∞ÁªüËÆ°&#58;</span>
                
                <span title="Â≠óÊï∞ÁªüËÆ°">
                  3.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">ÈòÖËØªÊó∂Èïø &asymp;</span>
                
                <span title="ÈòÖËØªÊó∂Èïø">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/2019/11/04/9openresty/./openresty.svg" width="600px"><br>Áî±‰∫éÂÖ¨Âè∏CÁ´Ø‰∏öÂä°ÁöÑ Nginx Ê°ÜÊû∂‰ΩøÁî®ÁöÑÊòØOpenResty„ÄÇÂú®‰∏ä‰∏ÄÁØáÊñáÁ´†Â≠¶‰π†‰∫Ü Nginx Âü∫Á°ÄÁü•ËØÜÂêéÔºåÂÜ≥ÂÆöÂÜçÂ≠¶‰π†‰∏Ä‰∏ã Lua Âíå OpenResty„ÄÇÊú¨ÊñáËÆ∞ÂΩï‰∫ÜËá™Â∑±Â≠¶‰π†ËøáÁ®ã‰∏≠ÁöÑ‰∏Ä‰∫õÁ¨îËÆ∞ÂíåÊÄªÁªìÔºåÂ∞ùËØï‰∫ÜOpenRestyÂú®Êú¨Âú∞Êê≠Âª∫ÁÆÄÂçïÁöÑAPI ServerÊ°ÜÊû∂ÁöÑdemoÔºåÂåÖÊã¨Â§ÑÁêÜÊé•Âè£Ë∑ØÁî±‰ª•ÂèäÊìç‰Ωú Redis ÁöÑÁöÑÊµÅÁ®ã„ÄÇÈÄöËøáÂ≠¶‰π†ÔºåÊú™Â∞ÜÊù•ÂèØËÉΩÊ∂âÂèäÂà∞OpenRestyÁöÑÂºÄÂèëÂÅö‰∏Ä‰∫õÂáÜÂ§á„ÄÇ</p>
<a id="more"></a>
<hr>
<h2 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h2><p>Lua ÊòØ‰∏Ä‰∏™Â∞èÂ∑ßÁöÑËÑöÊú¨ËØ≠Ë®Ä„ÄÇÊòØÂ∑¥Ë•øÈáåÁ∫¶ÁÉ≠ÂÜÖÂç¢Â§©‰∏ªÊïôÂ§ßÂ≠¶ÔºàPontifical Catholic University of Rio de JaneiroÔºâÈáåÁöÑ‰∏Ä‰∏™Á†îÁ©∂Â∞èÁªÑÔºåÁî± Roberto Ierusalimschy„ÄÅWaldemar Celes Âíå Luiz Henrique de Figueiredo ÊâÄÁªÑÊàêÂπ∂‰∫é 1993 Âπ¥ÂºÄÂèë„ÄÇÂÖ∂ËÆæËÆ°ÁõÆÁöÑÊòØ‰∏∫‰∫ÜÂµåÂÖ•Â∫îÁî®Á®ãÂ∫è‰∏≠Ôºå‰ªéËÄå‰∏∫Â∫îÁî®Á®ãÂ∫èÊèê‰æõÁÅµÊ¥ªÁöÑÊâ©Â±ïÂíåÂÆöÂà∂ÂäüËÉΩ„ÄÇLua Áî±Ê†áÂáÜ C ÁºñÂÜôËÄåÊàêÔºåÂá†‰πéÂú®ÊâÄÊúâÊìç‰ΩúÁ≥ªÁªüÂíåÂπ≥Âè∞‰∏äÈÉΩÂèØ‰ª•ÁºñËØë„ÄÅËøêË°å„ÄÇLua Âπ∂Ê≤°ÊúâÊèê‰æõÂº∫Â§ßÁöÑÂ∫ìÔºåËøôÊòØÁî±ÂÆÉÁöÑÂÆö‰ΩçÂÜ≥ÂÆöÁöÑ„ÄÇÊâÄ‰ª• Lua ‰∏çÈÄÇÂêà‰Ωú‰∏∫ÂºÄÂèëÁã¨Á´ãÂ∫îÁî®Á®ãÂ∫èÁöÑËØ≠Ë®Ä„ÄÇLua Êúâ‰∏Ä‰∏™ÂêåÊó∂ËøõË°åÁöÑ JIT È°πÁõÆÔºåÊèê‰æõÂú®ÁâπÂÆöÂπ≥Âè∞‰∏äÁöÑÂç≥Êó∂ÁºñËØëÂäüËÉΩ„ÄÇ</p>
<p>Lua ËÑöÊú¨ÂèØ‰ª•ÂæàÂÆπÊòìÁöÑË¢´ C/C++ ‰ª£Á†ÅË∞ÉÁî®Ôºå‰πüÂèØ‰ª•ÂèçËøáÊù•Ë∞ÉÁî® C/C++ ÁöÑÂáΩÊï∞ÔºåËøô‰ΩøÂæó Lua Âú®Â∫îÁî®Á®ãÂ∫è‰∏≠ÂèØ‰ª•Ë¢´ÂπøÊ≥õÂ∫îÁî®„ÄÇ‰∏ç‰ªÖ‰ªÖ‰Ωú‰∏∫Êâ©Â±ïËÑöÊú¨Ôºå‰πüÂèØ‰ª•‰Ωú‰∏∫ÊôÆÈÄöÁöÑÈÖçÁΩÆÊñá‰ª∂Ôºå‰ª£Êõø XML„ÄÅini Á≠âÊñá‰ª∂Ê†ºÂºèÔºåÂπ∂‰∏îÊõ¥ÂÆπÊòìÁêÜËß£ÂíåÁª¥Êä§„ÄÇÊ†áÂáÜ Lua 5.1 Ëß£ÈáäÂô®Áî±Ê†áÂáÜ C ÁºñÂÜôËÄåÊàêÔºå‰ª£Á†ÅÁÆÄÊ¥Å‰ºòÁæéÔºåÂá†‰πéÂú®ÊâÄÊúâÊìç‰ΩúÁ≥ªÁªüÂíåÂπ≥Âè∞‰∏äÈÉΩÂèØ‰ª•ÁºñËØëÂíåËøêË°åÔºõ‰∏Ä‰∏™ÂÆåÊï¥ÁöÑÊ†áÂáÜ Lua 5.1 Ëß£ÈáäÂô®‰∏çË∂≥ 200KB„ÄÇËÄåÊú¨‰π¶Êé®Ëçê‰ΩøÁî®ÁöÑ LuaJIT 2 ÁöÑ‰ª£Á†ÅÂ§ßÂ∞è‰πüÂè™Êúâ‰∏çË∂≥ 500KBÔºåÂêåÊó∂‰πüÊîØÊåÅÂ§ßÈÉ®ÂàÜÂ∏∏ËßÅÁöÑ‰ΩìÁ≥ªÁªìÊûÑ„ÄÇÂú®ÁõÆÂâçÊâÄÊúâËÑöÊú¨ËØ≠Ë®ÄÂºïÊìé‰∏≠ÔºåLuaJIT 2 ÂÆûÁé∞ÁöÑÈÄüÂ∫¶Â∫îËØ•ÁÆóÊòØÊúÄÂø´ÁöÑ‰πã‰∏Ä„ÄÇËøô‰∏ÄÂàáÈÉΩÂÜ≥ÂÆö‰∫Ü Lua ÊòØ‰Ωú‰∏∫ÂµåÂÖ•ÂºèËÑöÊú¨ÁöÑÊúÄ‰Ω≥ÈÄâÊã©„ÄÇ</p>
<p>Lua ËØ≠Ë®ÄÁöÑÂêÑ‰∏™ÁâàÊú¨ÊòØ‰∏çÁõ∏ÂÖºÂÆπÁöÑ„ÄÇÂõ†Ê≠§Êú¨‰π¶Âè™‰ªãÁªç Lua 5.1 ËØ≠Ë®ÄÔºåËøôÊòØ‰∏∫Ê†áÂáÜ Lua 5.1 Ëß£ÈáäÂô®Âíå LuaJIT 2 ÊâÄÂÖ±ÂêåÊîØÊåÅÁöÑ„ÄÇLuaJIT ÊîØÊåÅÁöÑÂØπ Lua 5.1 ÂêëÂêéÂÖºÂÆπÁöÑ Lua 5.2 Âíå Lua 5.3 ÁöÑÁâπÊÄßÔºåÊàë‰ª¨‰πü‰ºöÂú®Êñπ‰æøÁöÑÊó∂ÂÄô‰∫à‰ª•‰ªãÁªç„ÄÇ</p>
<p><a href="https://www.jianshu.com/p/70769e81d6cf" target="_blank" rel="noopener">ÂÆâË£ÖLuaJITÈÅáÂà∞ÁöÑÈóÆÈ¢ò</a></p>
<h3 id="LuaÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûã"><a href="#LuaÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûã" class="headerlink" title="LuaÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûã"></a>LuaÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûã</h3><ul>
<li>nilÔºàÁ©∫ÔºâÔºönil ÊòØ‰∏ÄÁßçÁ±ªÂûãÔºåLua Â∞Ü nil Áî®‰∫éË°®Á§∫‚ÄúÊó†ÊïàÂÄº‚Äù„ÄÇ‰∏Ä‰∏™ÂèòÈáèÂú®Á¨¨‰∏ÄÊ¨°ËµãÂÄºÂâçÁöÑÈªòËÆ§ÂÄºÊòØ nilÔºåÂ∞Ü nil Ëµã‰∫àÁªô‰∏Ä‰∏™ÂÖ®Â±ÄÂèòÈáèÂ∞±Á≠âÂêå‰∫éÂà†Èô§ÂÆÉ„ÄÇ</li>
<li>booleanÔºàÂ∏ÉÂ∞îÔºâÔºöÂèØÈÄâÂÄº true/falseÔºõLua ‰∏≠ nil Âíå false ‰∏∫‚ÄúÂÅá‚ÄùÔºåÂÖ∂ÂÆÉÊâÄÊúâÂÄºÂùá‰∏∫‚ÄúÁúü‚Äù„ÄÇ<strong>Ôºà0ÂíåÁ©∫Â≠óÁ¨¶‰∏≤ÊòØ‚ÄùÁúü‚ÄùÔºâ</strong></li>
<li>numberÔºàÊï∞Â≠óÔºâ</li>
<li>stringÔºàÂ≠óÁ¨¶‰∏≤Ôºâ</li>
<li>table (Ë°®)ÔºöTable Á±ªÂûãÂÆûÁé∞‰∫Ü‰∏ÄÁßçÊäΩË±°ÁöÑ‚ÄúÂÖ≥ËÅîÊï∞ÁªÑ‚ÄùÔºåÈÄöÂ∏∏ÂÆûÁé∞‰∏∫‰∏Ä‰∏™ÂìàÂ∏åË°®„ÄÅ‰∏Ä‰∏™Êï∞ÁªÑ„ÄÅÊàñËÄÖ‰∏§ËÄÖÁöÑÊ∑∑Âêà„ÄÇ</li>
<li>function (ÂáΩÊï∞)ÔºöÂú® Lua ‰∏≠ÔºåÂáΩÊï∞ ‰πüÊòØ‰∏ÄÁßçÊï∞ÊçÆÁ±ªÂûãÔºåÂáΩÊï∞ÂèØ‰ª•Â≠òÂÇ®Âú®ÂèòÈáè‰∏≠ÔºåÂèØ‰ª•ÈÄöËøáÂèÇÊï∞‰º†ÈÄíÁªôÂÖ∂‰ªñÂáΩÊï∞ÔºåËøòÂèØ‰ª•‰Ωú‰∏∫ÂÖ∂‰ªñÂáΩÊï∞ÁöÑËøîÂõûÂÄº„ÄÇ</li>
</ul>
<h3 id="LuaË°®ËææÂºè"><a href="#LuaË°®ËææÂºè" class="headerlink" title="LuaË°®ËææÂºè"></a>LuaË°®ËææÂºè</h3><ul>
<li>ÁÆóÊúØËøêÁÆóÁ¨¶Ôºö + - * / ^ %</li>
<li>ÂÖ≥Á≥ªËøêÁÆóÁ¨¶Ôºö &lt; &gt; &lt;= &gt;= == ~=(‰∏çÁ≠â‰∫é)<blockquote>
<p>Lua Â≠óÁ¨¶‰∏≤ÊÄªÊòØ‰ºöË¢´‚ÄúÂÜÖÂåñ‚ÄùÔºåÂç≥Áõ∏ÂêåÂÜÖÂÆπÁöÑÂ≠óÁ¨¶‰∏≤Âè™‰ºöË¢´‰øùÂ≠ò‰∏Ä‰ªΩÔºåÂõ†Ê≠§ Lua Â≠óÁ¨¶‰∏≤‰πãÈó¥ÁöÑÁõ∏Á≠âÊÄßÊØîËæÉÂèØ‰ª•ÁÆÄÂåñ‰∏∫ÂÖ∂ÂÜÖÈÉ®Â≠òÂÇ®Âú∞ÂùÄÁöÑÊØîËæÉ„ÄÇËøôÊÑèÂë≥ÁùÄ Lua Â≠óÁ¨¶‰∏≤ÁöÑÁõ∏Á≠âÊÄßÊØîËæÉÊÄªÊòØ‰∏∫ O(1). ËÄåÂú®ÂÖ∂‰ªñÁºñÁ®ãËØ≠Ë®Ä‰∏≠ÔºåÂ≠óÁ¨¶‰∏≤ÁöÑÁõ∏Á≠âÊÄßÊØîËæÉÂàôÈÄöÂ∏∏‰∏∫ O(n)ÔºåÂç≥ÈúÄË¶ÅÈÄê‰∏™Â≠óËäÇÔºàÊàñÊåâËã•Âπ≤‰∏™ËøûÁª≠Â≠óËäÇÔºâËøõË°åÊØîËæÉ„ÄÇ</p>
</blockquote>
</li>
<li>ÈÄªËæëËøêÁÆóÁ¨¶Ôºö and(‰∏é) or(Êàñ) not(Èùû)  ÔºàÂØπ‰∫é notÔºåÊ∞∏ËøúÂè™ËøîÂõû true ÊàñËÄÖ falseÔºâ</li>
</ul>
<h3 id="ÊéßÂà∂ÁªìÊûÑ"><a href="#ÊéßÂà∂ÁªìÊûÑ" class="headerlink" title="ÊéßÂà∂ÁªìÊûÑ"></a>ÊéßÂà∂ÁªìÊûÑ</h3><ul>
<li><p>if/else</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">score = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> score == <span class="number">100</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Very good!Your score is 100"</span>)</span><br><span class="line"><span class="keyword">elseif</span> score &gt;= <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Congratulations, you have passed it,your score greater or equal to 60"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> score &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Your score is better than 0"</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"My God, your score turned out to be 0"</span>)</span><br><span class="line">    <span class="keyword">end</span> <span class="comment">--‰∏é‰∏ä‰∏ÄÁ§∫‰æã‰ª£Á†Å‰∏çÂêåÁöÑÊòØÔºåÊ≠§Â§ÑË¶ÅÊ∑ªÂä†‰∏Ä‰∏™end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>while</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">18</span>, <span class="number">21</span>&#125;</span><br><span class="line"><span class="keyword">local</span> i</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">11</span> == v <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"index["</span> .. i .. <span class="string">"] have right value[11]"</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Ê®°Âùó"><a href="#Ê®°Âùó" class="headerlink" title="Ê®°Âùó"></a>Ê®°Âùó</h3><p>‰∏Ä‰∏™ Lua Ê®°ÂùóÁöÑÊï∞ÊçÆÁªìÊûÑÊòØÁî®‰∏Ä‰∏™ Lua ÂÄºÔºàÈÄöÂ∏∏ÊòØ‰∏Ä‰∏™ Lua Ë°®ÊàñËÄÖ Lua ÂáΩÊï∞Ôºâ„ÄÇ‰∏Ä‰∏™ Lua Ê®°Âùó‰ª£Á†ÅÂ∞±ÊòØ‰∏Ä‰∏™‰ºöËøîÂõûËøô‰∏™ Lua ÂÄºÁöÑ‰ª£Á†ÅÂùó„ÄÇ ÂèØ‰ª•‰ΩøÁî®ÂÜÖÂª∫ÂáΩÊï∞ require() Êù•Âä†ËΩΩÂíåÁºìÂ≠òÊ®°Âùó„ÄÇÁÆÄÂçïÁöÑËØ¥Ôºå‰∏Ä‰∏™‰ª£Á†ÅÊ®°ÂùóÂ∞±ÊòØ‰∏Ä‰∏™Á®ãÂ∫èÂ∫ìÔºåÂèØ‰ª•ÈÄöËøá require Êù•Âä†ËΩΩ„ÄÇÊ®°ÂùóÂä†ËΩΩÂêéÁöÑÁªìÊûúÈÄöËøáÊòØ‰∏Ä‰∏™ Lua tableÔºåËøô‰∏™Ë°®Â∞±ÂÉèÊòØ‰∏Ä‰∏™ÂëΩÂêçÁ©∫Èó¥ÔºåÂÖ∂ÂÜÖÂÆπÂ∞±ÊòØÊ®°Âùó‰∏≠ÂØºÂá∫ÁöÑÊâÄÊúâ‰∏úË•øÔºåÊØîÂ¶ÇÂáΩÊï∞ÂíåÂèòÈáè„ÄÇrequire ÂáΩÊï∞‰ºöËøîÂõû Lua Ê®°ÂùóÂä†ËΩΩÂêéÁöÑÁªìÊûúÔºåÂç≥Áî®‰∫éË°®Á§∫ËØ• Lua Ê®°ÂùóÁöÑ Lua ÂÄº„ÄÇ</p>
<h2 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h2><p>OpenResty¬Æ ÊòØ‰∏Ä‰∏™Âü∫‰∫é Nginx ‰∏é Lua ÁöÑÈ´òÊÄßËÉΩ Web Âπ≥Âè∞ÔºåÂÖ∂ÂÜÖÈÉ®ÈõÜÊàê‰∫ÜÂ§ßÈáèÁ≤æËâØÁöÑ Lua Â∫ì„ÄÅÁ¨¨‰∏âÊñπÊ®°Âùó‰ª•ÂèäÂ§ßÂ§öÊï∞ÁöÑ‰æùËµñÈ°π„ÄÇÁî®‰∫éÊñπ‰æøÂú∞Êê≠Âª∫ËÉΩÂ§üÂ§ÑÁêÜË∂ÖÈ´òÂπ∂Âèë„ÄÅÊâ©Â±ïÊÄßÊûÅÈ´òÁöÑÂä®ÊÄÅ Web Â∫îÁî®„ÄÅWeb ÊúçÂä°ÂíåÂä®ÊÄÅÁΩëÂÖ≥„ÄÇ</p>
<p>OpenResty¬Æ ÈÄöËøáÊ±áËÅöÂêÑÁßçËÆæËÆ°Á≤æËâØÁöÑ Nginx Ê®°ÂùóÔºà‰∏ªË¶ÅÁî± OpenResty Âõ¢ÈòüËá™‰∏ªÂºÄÂèëÔºâÔºå‰ªéËÄåÂ∞Ü Nginx ÊúâÊïàÂú∞ÂèòÊàê‰∏Ä‰∏™Âº∫Â§ßÁöÑÈÄöÁî® Web Â∫îÁî®Âπ≥Âè∞„ÄÇËøôÊ†∑ÔºåWeb ÂºÄÂèë‰∫∫ÂëòÂíåÁ≥ªÁªüÂ∑•Á®ãÂ∏àÂèØ‰ª•‰ΩøÁî® Lua ËÑöÊú¨ËØ≠Ë®ÄË∞ÉÂä® Nginx ÊîØÊåÅÁöÑÂêÑÁßç C ‰ª•Âèä Lua Ê®°ÂùóÔºåÂø´ÈÄüÊûÑÈÄ†Âá∫Ë∂≥‰ª•ËÉú‰ªª 10K ‰πÉËá≥ 1000K ‰ª•‰∏äÂçïÊú∫Âπ∂ÂèëËøûÊé•ÁöÑÈ´òÊÄßËÉΩ Web Â∫îÁî®Á≥ªÁªü„ÄÇ</p>
<p>OpenResty¬Æ ÁöÑÁõÆÊ†áÊòØËÆ©‰Ω†ÁöÑWebÊúçÂä°Áõ¥Êé•Ë∑ëÂú® Nginx ÊúçÂä°ÂÜÖÈÉ®ÔºåÂÖÖÂàÜÂà©Áî® Nginx ÁöÑÈùûÈòªÂ°û I/O Ê®°ÂûãÔºå‰∏ç‰ªÖ‰ªÖÂØπ HTTP ÂÆ¢Êà∑Á´ØËØ∑Ê±Ç,ÁîöËá≥‰∫éÂØπËøúÁ®ãÂêéÁ´ØËØ∏Â¶Ç MySQL„ÄÅPostgreSQL„ÄÅMemcached ‰ª•Âèä Redis Á≠âÈÉΩËøõË°å‰∏ÄËá¥ÁöÑÈ´òÊÄßËÉΩÂìçÂ∫î„ÄÇ</p>
<p><a href="https://moonbingbing.gitbooks.io/openresty-best-practices/lua/class.html" target="_blank" rel="noopener">gitbook</a></p>
<h3 id="‰∏élocationÈÖçÂêà"><a href="#‰∏élocationÈÖçÂêà" class="headerlink" title="‰∏élocationÈÖçÂêà"></a>‰∏élocationÈÖçÂêà</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">location = /sum &#123;</span><br><span class="line">    # Âè™ÂÖÅËÆ∏ÂÜÖÈÉ®Ë∞ÉÁî®</span><br><span class="line">    internal;</span><br><span class="line"></span><br><span class="line">    # ËøôÈáåÂÅö‰∫Ü‰∏Ä‰∏™Ê±ÇÂíåËøêÁÆóÂè™ÊòØ‰∏Ä‰∏™‰æãÂ≠êÔºåÂèØ‰ª•Âú®ËøôÈáåÂÆåÊàê‰∏Ä‰∫õÊï∞ÊçÆÂ∫ì„ÄÅ</span><br><span class="line">    # ÁºìÂ≠òÊúçÂä°Âô®ÁöÑÊìç‰ΩúÔºåËææÂà∞Âü∫Á°ÄÊ®°ÂùóÂíå‰∏öÂä°ÈÄªËæëÂàÜÁ¶ªÁõÆÁöÑ</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">        ngx.say(<span class="built_in">tonumber</span>(args.a) + <span class="built_in">tonumber</span>(args.b))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /subduction &#123;</span><br><span class="line">    internal;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">        ngx.<span class="built_in">print</span>(<span class="built_in">tonumber</span>(args.a) - <span class="built_in">tonumber</span>(args.b))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /app/test_parallels &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> start_time = ngx.now()</span><br><span class="line">        <span class="keyword">local</span> res1, res2 = ngx.location.capture_multi( &#123;</span><br><span class="line">                        &#123;<span class="string">"/sum"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;,</span><br><span class="line">                        &#123;<span class="string">"/subduction"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res1.<span class="built_in">status</span>, <span class="string">" response:"</span>, res1.body)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res2.<span class="built_in">status</span>, <span class="string">" response:"</span>, res2.body)</span><br><span class="line">        ngx.say(<span class="string">"time used:"</span>, ngx.now() - start_time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /app/test_queue &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> start_time = ngx.now()</span><br><span class="line">        <span class="keyword">local</span> res1 = ngx.location.capture_multi( &#123;</span><br><span class="line">                        &#123;<span class="string">"/sum"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        <span class="keyword">local</span> res2 = ngx.location.capture_multi( &#123;</span><br><span class="line">                        &#123;<span class="string">"/subduction"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res1.<span class="built_in">status</span>, <span class="string">" response:"</span>, res1.body)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res2.<span class="built_in">status</span>, <span class="string">" response:"</span>, res2.body)</span><br><span class="line">        ngx.say(<span class="string">"time used:"</span>, ngx.now() - start_time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Âà©Áî® ngx.location.capture_multi ÂáΩÊï∞ÔºåÁõ¥Êé•ÂÆåÊàê‰∫Ü‰∏§‰∏™Â≠êËØ∑Ê±ÇÂπ∂Ë°åÊâßË°å„ÄÇÂΩì‰∏§‰∏™ËØ∑Ê±ÇÊ≤°ÊúâÁõ∏‰∫í‰æùËµñÔºåËøôÁßçÊñπÊ≥ïÂèØ‰ª•ÊûÅÂ§ßÊèêÈ´òÊü•ËØ¢ÊïàÁéá„ÄÇ</p>
<h3 id="Ëé∑ÂèñuriÂèÇÊï∞"><a href="#Ëé∑ÂèñuriÂèÇÊï∞" class="headerlink" title="Ëé∑ÂèñuriÂèÇÊï∞"></a>Ëé∑ÂèñuriÂèÇÊï∞</h3><h4 id="Ëé∑ÂèñËØ∑Ê±ÇuriÂèÇÊï∞"><a href="#Ëé∑ÂèñËØ∑Ê±ÇuriÂèÇÊï∞" class="headerlink" title="Ëé∑ÂèñËØ∑Ê±ÇuriÂèÇÊï∞"></a>Ëé∑ÂèñËØ∑Ê±ÇuriÂèÇÊï∞</h4><ul>
<li>ÊñπÊ≥ï<code>ngx.req.get_uri_args</code>ÔºöËé∑ÂèñÊù•Ëá™ uri ËØ∑Ê±ÇÁöÑÂèÇÊï∞</li>
<li>ÊñπÊ≥ï<code>ngx.req.get_post_args</code>ÔºöËé∑ÂèñÊù•Ëá™ post ËØ∑Ê±ÇÁöÑÂÜÖÂÆπ<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location /print_param &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> <span class="built_in">arg</span> = ngx.req.get_uri_args()</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">            ngx.say(<span class="string">"[GET ] key:"</span>, k, <span class="string">" v:"</span>, v)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        ngx.req.read_body() <span class="comment">-- Ëß£Êûê body ÂèÇÊï∞‰πãÂâç‰∏ÄÂÆöË¶ÅÂÖàËØªÂèñ body</span></span><br><span class="line">        <span class="keyword">local</span> <span class="built_in">arg</span> = ngx.req.get_post_args()</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">            ngx.say(<span class="string">"[POST] key:"</span>, k, <span class="string">" v:"</span>, v)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="‰º†ÈÄíËØ∑Ê±ÇuriÂèÇÊï∞"><a href="#‰º†ÈÄíËØ∑Ê±ÇuriÂèÇÊï∞" class="headerlink" title="‰º†ÈÄíËØ∑Ê±ÇuriÂèÇÊï∞"></a>‰º†ÈÄíËØ∑Ê±ÇuriÂèÇÊï∞</h4><ul>
<li>ÊñπÊ≥ï<code>ngx.encode_args</code>ÔºöËøõË°åËßÑÂàôËΩ¨‰πâ<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location /test &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> res = ngx.location.capture(</span><br><span class="line">                <span class="string">'/print_param'</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    method = ngx.HTTP_POST,</span><br><span class="line">                    args = ngx.encode_args(&#123;a = <span class="number">1</span>, b = <span class="string">'2&amp;'</span>&#125;),</span><br><span class="line">                    body = ngx.encode_args(&#123;c = <span class="number">3</span>, d = <span class="string">'4&amp;'</span>&#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        ngx.say(res.body)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Ëé∑ÂèñËØ∑Ê±Çbody"><a href="#Ëé∑ÂèñËØ∑Ê±Çbody" class="headerlink" title="Ëé∑ÂèñËØ∑Ê±Çbody"></a>Ëé∑ÂèñËØ∑Ê±Çbody</h3><p>Âú® Nginx ÁöÑÂÖ∏ÂûãÂ∫îÁî®Âú∫ÊôØ‰∏≠ÔºåÂá†‰πéÈÉΩÊòØÂè™ËØªÂèñ HTTP Â§¥Âç≥ÂèØÔºå‰æãÂ¶ÇË¥üËΩΩÂùáË°°„ÄÅÊ≠£ÂèçÂêë‰ª£ÁêÜÁ≠âÂú∫ÊôØ„ÄÇ‰ΩÜÊòØÂØπ‰∫é API Server ÊàñËÄÖ Web Application ÔºåÂØπ body ÂèØ‰ª•ËØ¥Â∞±ÊØîËæÉÊïèÊÑü‰∫Ü„ÄÇÁî±‰∫é OpenResty Âü∫‰∫é Nginx ÔºåÊâÄ‰ª•Â§©ÁÑ∂ÁöÑÂØπËØ∑Ê±Ç body ÁöÑËØªÂèñÁªÜËäÇ‰∏éÂÖ∂‰ªñÊàêÁÜü Web Ê°ÜÊû∂Êúâ‰∫õ‰∏çÂêå„ÄÇ                                                                   </p>
<ul>
<li>ÊñπÊ≥ï<code>ngx.req.get_body_data</code>ÔºöËé∑ÂèñËØ∑Ê±ÇÁöÑbodyÈÉ®ÂàÜ<blockquote>
<p>Ê≥®ÊÑèÔºöËé∑ÂèñbodyÈÉ®ÂàÜÈúÄË¶ÅÊ∑ªÂä†Êåá‰ª§ <code>lua_need_request_body on;</code>ÔºåÂõ†‰∏∫‰∏ªË¶ÅÊòØ Nginx ËØûÁîü‰πãÂàù‰∏ªË¶ÅÊòØ‰∏∫‰∫ÜËß£ÂÜ≥Ë¥üËΩΩÂùáË°°ÊÉÖÂÜµÔºåËÄåËøôÁßçÊÉÖÂÜµÔºåÊòØ‰∏çÈúÄË¶ÅËØªÂèñ body Â∞±ÂèØ‰ª•ÂÜ≥ÂÆöË¥üËΩΩÁ≠ñÁï•ÁöÑÔºåÊâÄ‰ª•ÈªòËÆ§ÊòØ‰∏çËÉΩËé∑ÂèñËØ∑Ê±Ç‰ΩìÁöÑÔºõ</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># ÈªòËÆ§ËØªÂèñ body</span><br><span class="line">lua_need_request_body on;</span><br><span class="line"></span><br><span class="line">location /test &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> data = ngx.req.get_body_data()</span><br><span class="line">        ngx.say(<span class="string">"hello "</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p>Â¶ÇÊûú‰Ω†Âè™ÊòØÊüê‰∏™Êé•Âè£ÈúÄË¶ÅËØªÂèñ bodyÔºàÂπ∂ÈùûÂÖ®Â±ÄË°å‰∏∫ÔºâÔºåÈÇ£‰πàËøôÊó∂ÂÄô‰πüÂèØ‰ª•ÊòæÁ§∫Ë∞ÉÁî® <code>ngx.req.read_body()</code> Êé•Âè£Ôºö<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location /test &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.req.read_body()</span><br><span class="line">        <span class="keyword">local</span> data = ngx.req.get_body_data()</span><br><span class="line">        ngx.say(<span class="string">"hello "</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="ËæìÂá∫ÂìçÂ∫î‰Ωì"><a href="#ËæìÂá∫ÂìçÂ∫î‰Ωì" class="headerlink" title="ËæìÂá∫ÂìçÂ∫î‰Ωì"></a>ËæìÂá∫ÂìçÂ∫î‰Ωì</h3><p>Âú®OpenResty ‰∏≠Ë∞ÉÁî®<code>ngx.say</code> ‰∏é <code>ngx.print</code>ÂèØ‰ª•ËæìÂá∫ÂìçÂ∫î‰ΩìÔºå‰∫åËÄÖÂå∫Âà´Âú®‰∫éÔºö<code>ngx.say</code> ËæìÂá∫ÁöÑÂìçÂ∫î‰Ωì‰ºöÂ§ö‰∏Ä‰∏™Êç¢Ë°åÁ¨¶ \n„ÄÇ</p>
<blockquote>
<p>Ê≥®ÊÑè<code>ngx.say</code> ‰∏é <code>ngx.print</code> ÈÉΩÊòØÂºÇÊ≠•ËæìÂá∫</p>
</blockquote>
<h4 id="Â§ÑÁêÜÂìçÂ∫î‰ΩìËøáÂ§ßÁöÑËæìÂá∫"><a href="#Â§ÑÁêÜÂìçÂ∫î‰ΩìËøáÂ§ßÁöÑËæìÂá∫" class="headerlink" title="Â§ÑÁêÜÂìçÂ∫î‰ΩìËøáÂ§ßÁöÑËæìÂá∫"></a>Â§ÑÁêÜÂìçÂ∫î‰ΩìËøáÂ§ßÁöÑËæìÂá∫</h4><ul>
<li><p>ËæìÂá∫ÂÜÖÂÆπÊú¨Ë∫´‰ΩìÁßØÂæàÂ§ßÔºå‰æãÂ¶ÇË∂ÖËøá 2G ÁöÑÊñá‰ª∂‰∏ãËΩΩ<br>Âà©Áî® HTTP 1.1 ÁâπÊÄß CHUNKED ÁºñÁ†ÅÔºåÊää‰∏Ä‰∏™Â§ßÁöÑÂìçÂ∫î‰ΩìÊãÜÂàÜÊàêÂ§ö‰∏™Â∞èÁöÑÂ∫îÁ≠î‰ΩìÔºåÂàÜÊâπ„ÄÅÊúâËäÇÂà∂ÁöÑÂìçÂ∫îÁªôËØ∑Ê±ÇÊñπ„ÄÇ</p>
</li>
<li><p>ËæìÂá∫ÂÜÖÂÆπÊú¨Ë∫´ÊòØÁî±ÂêÑÁßçÁ¢éÁâáÊãºÂáëÁöÑÔºåÁ¢éÁâáÊï∞ÈáèÂ∫ûÂ§ßÔºå‰æãÂ¶ÇÂ∫îÁ≠îÊï∞ÊçÆÊòØÊüêÂú∞Âå∫ÊâÄÊúâ‰∫∫ÁöÑÂßìÂêç<br>Âà©Áî® ngx.print ËæìÂÖ•ÂèÇÊï∞ÂèØ‰ª•ÊòØÂçï‰∏™ÊàñÂ§ö‰∏™Â≠óÁ¨¶‰∏≤ÂèÇÊï∞Ôºå‰πüÂèØ‰ª•ÊòØ table ÂØπË±°ÁöÑËøô‰∏ÄÁâπÊÄßÔºåÊääÁ¢éÁâáÊï∞ÊçÆÁõ¥Êé•Â≠òÊîæÂú® table ‰∏≠ÔºåÁî®Êï∞ÁªÑÁöÑÊñπÂºèÊääËøô‰∫õÁ¢éÁâáÊï∞ÊçÆÁªü‰∏ÄËµ∑Êù•ÔºåÁõ¥Êé•Ë∞ÉÁî® ngx.print(tableÔºâÂç≥ÂèØ„ÄÇ</p>
</li>
</ul>
<h3 id="ÁÆÄÂçïAPI-ServerÊ°ÜÊû∂"><a href="#ÁÆÄÂçïAPI-ServerÊ°ÜÊû∂" class="headerlink" title="ÁÆÄÂçïAPI ServerÊ°ÜÊû∂"></a>ÁÆÄÂçïAPI ServerÊ°ÜÊû∂</h3><ul>
<li>È¶ñÂÖàÔºåÈÖçÁΩÆÂ§ö‰∏™APIÊó∂Ôºå‰∏∫‰∫Ü‰øùÊåÅ nginx ÈÖçÁΩÆÊñá‰ª∂ÁöÑÁÆÄÊ¥ÅÔºåË¶ÅÊääËøô‰∫õÊé•Âè£ÁöÑÂÆûÁé∞ÊîæÂà∞ÂêÑËá™ÁöÑÁã¨Á´ã<code>lua</code>Êñá‰ª∂‰∏≠Ôºõ</li>
<li>ÂÖ∂Ê¨°ÔºåÂØπÊØè‰∏™ API ÈÉΩÂÜô‰∏Ä‰∏™ location‰ºöËÆ©NginxÈÖçÁΩÆÂèòÂæóÂ§çÊùÇÔºåÊâÄ‰ª•ÈúÄË¶ÅÊääÂÆÉ‰ª¨ÈÉΩÂêàÂπ∂Âà∞‰∏Ä‰∏™locationÈÖçÁΩÆ‰∏≠Ôºõ</li>
</ul>
<p>È¶ñÂÖàÔºåÂÆö‰πâluaÊñá‰ª∂ÊêúÁ¥¢Ë∑ØÂæÑÔºåËÆæÁΩÆlocationÊ≠£ÂàôÂåπÈÖçÔºåÊ†πÊçÆÂåπÈÖçÂà∞ÁöÑË∑ØÁî±ÂêçÁß∞ÊåáÂêëÂØπÂ∫îÁöÑluaÊñá‰ª∂Ôºõ<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    # ËÆæÁΩÆÈªòËÆ§ lua ÊêúÁ¥¢Ë∑ØÂæÑÔºåÊ∑ªÂä† lua Ë∑ØÂæÑ</span><br><span class="line">    # Ê≠§Â§ÑÂÜôÁõ∏ÂØπË∑ØÂæÑÊó∂ÔºåÂØπÂêØÂä® nginx ÁöÑË∑ØÂæÑÊúâË¶ÅÊ±ÇÔºåÂøÖÈ°ªÂú® nginx ÁõÆÂΩï‰∏ãÂêØÂä®Ôºå<span class="built_in">require</span> Êâæ‰∏çÂà∞</span><br><span class="line">    # comm.param ÁªùÂØπË∑ØÂæÑÂΩìÁÑ∂‰πüÊ≤°ÈóÆÈ¢òÔºå‰ΩÜÊòØ‰∏çÂèØÁßªÊ§çÔºåÂõ†Ê≠§Â∫î‰ΩøÁî®ÂèòÈáè $prefix Êàñ</span><br><span class="line">    # $&#123;prefix&#125;ÔºåOR ‰ºöÊõøÊç¢‰∏∫ nginx ÁöÑ prefix <span class="built_in">path</span></span><br><span class="line">    # lua_package_path <span class="string">'lua/?.lua;/blah/?.lua;;'</span>;</span><br><span class="line">    lua_package_path <span class="string">'$prefix/lua/?.lua;/blah/?.lua;;'</span>;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        location ~ ^/api/([-_a-zA-Z0<span class="number">-9</span>/]+) &#123;</span><br><span class="line">            # ÂáÜÂÖ•Èò∂ÊÆµÂÆåÊàêÂèÇÊï∞È™åËØÅ (Êñ≠Ë®ÄÔºüÔºü)</span><br><span class="line">            access_by_lua_file  lua/access_check.lua;</span><br><span class="line">            #ÂÜÖÂÆπÁîüÊàêÈò∂ÊÆµ</span><br><span class="line">            content_by_lua_file lua/$<span class="number">1.</span>lua;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Á¨¨‰∫åÊ≠•ÔºåÊñ∞Âª∫ÂÆûÁé∞Êé•Âè£ÁöÑluaÊñá‰ª∂ÔºåÁºñÂÜôÊé•Âè£ÈÄªËæëÔºåËæìÂá∫ÂìçÂ∫î‰ΩìÔºõ<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--========== &#123;$prefix&#125;/lua/addition.lua</span></span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">ngx.say(args.a + args.b)</span><br></pre></td></tr></table></figure></p>
<p>ÊúÄÂêéÔºåËøòÂèØ‰ª•Âä†‰∏Ä‰∏™ÂèÇÊï∞ÁöÑÊ£ÄÊü•È™åËØÅÁöÑÈÄªËæëÔºõ<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--========== &#123;$prefix&#125;/lua/comm/param.lua</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ÂØπËæìÂÖ•ÂèÇÊï∞ÈÄê‰∏™ËøõË°åÊ†°È™åÔºåÂè™Ë¶ÅÊúâ‰∏Ä‰∏™‰∏çÊòØÊï∞Â≠óÁ±ªÂûãÔºåÂàôËøîÂõû false</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M.is_number</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">arg</span> = &#123;...&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> num</span><br><span class="line">    <span class="keyword">for</span> _,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">        num = <span class="built_in">tonumber</span>(v)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">nil</span> == num <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _M</span><br><span class="line"></span><br><span class="line"><span class="comment">--========== &#123;$prefix&#125;/lua/access_check.lua</span></span><br><span class="line"><span class="keyword">local</span> param= <span class="built_in">require</span>(<span class="string">"comm.param"</span>)</span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> args.a <span class="keyword">or</span> <span class="keyword">not</span> args.b <span class="keyword">or</span> <span class="keyword">not</span> param.is_number(args.a, args.b) <span class="keyword">then</span></span><br><span class="line">    ngx.<span class="built_in">exit</span>(ngx.HTTP_BAD_REQUEST)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Â≠êÊü•ËØ¢"><a href="#Â≠êÊü•ËØ¢" class="headerlink" title="Â≠êÊü•ËØ¢"></a>Â≠êÊü•ËØ¢</h3><p>Nginx Â≠êËØ∑Ê±ÇÊòØ‰∏ÄÁßçÈùûÂ∏∏Âº∫ÊúâÂäõÁöÑÊñπÂºèÔºåÂÆÉÂèØ‰ª•ÂèëËµ∑ÈùûÈòªÂ°ûÁöÑÂÜÖÈÉ®ËØ∑Ê±ÇËÆøÈóÆÁõÆÊ†á location„ÄÇ‰ΩÜÊòØÂ≠êËØ∑Ê±ÇÂè™ÊòØÊ®°Êãü HTTP Êé•Âè£ÁöÑÂΩ¢ÂºèÔºå Ê≤°ÊúâÈ¢ùÂ§ñÁöÑ HTTP/TCP ÊµÅÈáèÔºå‰πüÊ≤°Êúâ IPC (ËøõÁ®ãÈó¥ÈÄö‰ø°) Ë∞ÉÁî®ÔºåÊâÄÊúâÂ∑•‰ΩúÂú®ÂÜÖÈÉ®È´òÊïàÂú∞Âú® C ËØ≠Ë®ÄÁ∫ßÂà´ÂÆåÊàê„ÄÇAPIÊñπÊ≥ï<code>ngx.location.capture</code>Âíå<code>ngx.location.capture_multi</code>„ÄÇ</p>
<h3 id="ËøûÊé•Redis"><a href="#ËøûÊé•Redis" class="headerlink" title="ËøûÊé•Redis"></a>ËøûÊé•Redis</h3><p>È¶ñÂÖàÂ∞ÜËøûÊé•RedisÁöÑÊñπÊ≥ïÂ∞ÅË£ÖÂú®redisÊñá‰ª∂Â§π‰∏ãÁöÑmain.lua‰∏≠ÔºåÂπ∂ÂØºÂá∫redisËøûÊé•ÂÆû‰æãÂØπË±°Ôºö<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Redis = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Redis.connect</span><span class="params">()</span></span></span><br><span class="line">  <span class="comment">-- ÂºïÂÖ•redisÂåÖ</span></span><br><span class="line">  <span class="keyword">local</span> redis = <span class="built_in">require</span> <span class="string">"resty.redis"</span></span><br><span class="line">  <span class="comment">-- ÂàõÂª∫Êñ∞ÁöÑredisËøûÊé•</span></span><br><span class="line">  <span class="keyword">local</span> red = redis:new()</span><br><span class="line">  <span class="comment">-- ËÆæÁΩÆredisËøûÊé•Ë∂ÖÊó∂Êó∂Èó¥</span></span><br><span class="line">  red:set_timeout(<span class="number">1000</span>) <span class="comment">-- 1 sec</span></span><br><span class="line">  <span class="comment">-- ÈÄöËøáipÂú∞ÂùÄÂíåÁ´ØÂè£Âª∫Á´ãËøûÊé•</span></span><br><span class="line">  <span class="keyword">local</span> ok, err = red:connect(<span class="string">"127.0.0.1"</span>, <span class="number">6379</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">      ngx.say(<span class="string">"failed to connect: "</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">return</span> red</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> Redis</span><br></pre></td></tr></table></figure></p>
<p>ÁÑ∂ÂêéÂÜçÊñ∞Âª∫‰∏Ä‰∏™redisÊìç‰ΩúÊñá‰ª∂ÔºåÂºïÁî®‰∏äÈù¢ÂØºÂá∫ÁöÑredisËøûÊé•ÂØπË±°ÔºåÂÅö‰∏Ä‰∫õÂØπÈîÆÂÄºÂØπÁöÑ set Âíå get Êìç‰ΩúÔºàÂÖ∂ÂÆûÔºåËøòÂèØ‰ª•ÂçïÁã¨Â∞ÅË£Öset„ÄÅgetÊñπÊ≥ïÔºâÔºåÂ∞ùËØïÊìç‰Ωú redisÔºö<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Redis = <span class="built_in">require</span>(<span class="string">"redis.main"</span>) <span class="comment">-- ÂºïÁî®‰∏äÈù¢ÂØºÂá∫ÁöÑredisËøûÊé•ÂØπË±°</span></span><br><span class="line"><span class="keyword">local</span> red = Redis.connect() <span class="comment">-- Ë∞ÉÁî®connectËøûÊé•ÊñπÊ≥ï</span></span><br><span class="line"><span class="comment">-- Ëé∑ÂèñurlÂèÇÊï∞</span></span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line"><span class="keyword">local</span> key = args.key</span><br><span class="line"><span class="keyword">local</span> value = args.value</span><br><span class="line"></span><br><span class="line"><span class="comment">-- set‰∏Ä‰∏™ÈîÆÂÄºÂØπ</span></span><br><span class="line">ok, err = red:set(key, value)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">"failed to set key: "</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">ngx.say(<span class="string">"set "</span>, key, <span class="string">": "</span>, ok)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ÂèñÂá∫ÂàöÂàösetÁöÑÈîÆÂÄºÂØπ</span></span><br><span class="line"><span class="keyword">local</span> res, err = red:get(key)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> res <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">"failed to get key: "</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">ngx.say(<span class="string">"get "</span>, key, <span class="string">": "</span>, res)</span><br></pre></td></tr></table></figure></p>
<p>ÊúÄÂêéÔºåÂú®Nginx.confÈáåÈÖçÁΩÆlocationÁöÑLua‰ª£Á†ÅÂùóÔºö<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~ ^<span class="regexp">/api/</span>([-_a-zA-Z0<span class="number">-9</span>/]+) &#123;</span><br><span class="line">    access_by_lua_file  lua/access_check.lua;</span><br><span class="line">    content_by_lua_file lua/$<span class="number">1.</span>lua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<!-- reloadÔºö nginx -p `pwd`/ -c conf/nginx.conf -s reload
Êü•ÁúãÔºöps -ef | grep nginx -->
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>‚Üò‚ÜòüëªÊàë‰∏çË¶ÅËÑ∏üëª‚Üô‚Üô</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>ÊâìËµè</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="AlexiXiang ÂæÆ‰ø°ÊîØ‰ªò">
        <p>ÂæÆ‰ø°ÊîØ‰ªò</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="AlexiXiang ÊîØ‰ªòÂÆù">
        <p>ÊîØ‰ªòÂÆù</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/study-notes/" rel="tag"># study notes</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/10/8nginx/" rel="next" title="Nginx Áõ∏ÂÖ≥Áü•ËØÜÁÇπÊÄªÁªìüëÄ">
                <i class="fa fa-chevron-left"></i> Nginx Áõ∏ÂÖ≥Áü•ËØÜÁÇπÊÄªÁªìüëÄ
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/15/10vue-modal-manager/" rel="prev" title="VueModalManager ‚Äî‚Äî ÁßªÂä®Á´ØÂÖ®Â±èÂºπÁ™óÁÆ°ÁêÜÊèí‰ª∂">
                VueModalManager ‚Äî‚Äî ÁßªÂä®Á´ØÂÖ®Â±èÂºπÁ™óÁÆ°ÁêÜÊèí‰ª∂ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNDM3My8xMDkxMA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            ÊñáÁ´†ÁõÆÂΩï
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Á´ôÁÇπÊ¶ÇËßà
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="AlexiXiang">
            
              <p class="site-author-name" itemprop="name">AlexiXiang</p>
              <p class="site-description motion-element" itemprop="description">Look ahead to the day you die.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">Êó•Âøó</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">ÂàÜÁ±ª</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">Ê†áÁ≠æ</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Alexixyc" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:alexixyc@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/profile.php?id=100019367790425" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.youtube.com/channel/UC6UTrplKuiGOwuqF4znDWAg?view_as=subscriber" target="_blank" title="YouTube">
                      
                        <i class="fa fa-fw fa-youtube"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.instagram.com/alexi_xiang/" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://dribbble.com/alexi_xiang" target="_blank" title="dribbble">
                      
                        <i class="fa fa-fw fa-dribbble"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua"><span class="nav-number">1.</span> <span class="nav-text">Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LuaÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûã"><span class="nav-number">1.1.</span> <span class="nav-text">LuaÂü∫Á°ÄÊï∞ÊçÆÁ±ªÂûã</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LuaË°®ËææÂºè"><span class="nav-number">1.2.</span> <span class="nav-text">LuaË°®ËææÂºè</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÊéßÂà∂ÁªìÊûÑ"><span class="nav-number">1.3.</span> <span class="nav-text">ÊéßÂà∂ÁªìÊûÑ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ê®°Âùó"><span class="nav-number">1.4.</span> <span class="nav-text">Ê®°Âùó</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenResty"><span class="nav-number">2.</span> <span class="nav-text">OpenResty</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#‰∏élocationÈÖçÂêà"><span class="nav-number">2.1.</span> <span class="nav-text">‰∏élocationÈÖçÂêà</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ëé∑ÂèñuriÂèÇÊï∞"><span class="nav-number">2.2.</span> <span class="nav-text">Ëé∑ÂèñuriÂèÇÊï∞</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Ëé∑ÂèñËØ∑Ê±ÇuriÂèÇÊï∞"><span class="nav-number">2.2.1.</span> <span class="nav-text">Ëé∑ÂèñËØ∑Ê±ÇuriÂèÇÊï∞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#‰º†ÈÄíËØ∑Ê±ÇuriÂèÇÊï∞"><span class="nav-number">2.2.2.</span> <span class="nav-text">‰º†ÈÄíËØ∑Ê±ÇuriÂèÇÊï∞</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ëé∑ÂèñËØ∑Ê±Çbody"><span class="nav-number">2.3.</span> <span class="nav-text">Ëé∑ÂèñËØ∑Ê±Çbody</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ËæìÂá∫ÂìçÂ∫î‰Ωì"><span class="nav-number">2.4.</span> <span class="nav-text">ËæìÂá∫ÂìçÂ∫î‰Ωì</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Â§ÑÁêÜÂìçÂ∫î‰ΩìËøáÂ§ßÁöÑËæìÂá∫"><span class="nav-number">2.4.1.</span> <span class="nav-text">Â§ÑÁêÜÂìçÂ∫î‰ΩìËøáÂ§ßÁöÑËæìÂá∫</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÁÆÄÂçïAPI-ServerÊ°ÜÊû∂"><span class="nav-number">2.5.</span> <span class="nav-text">ÁÆÄÂçïAPI ServerÊ°ÜÊû∂</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Â≠êÊü•ËØ¢"><span class="nav-number">2.6.</span> <span class="nav-text">Â≠êÊü•ËØ¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ËøûÊé•Redis"><span class="nav-number">2.7.</span> <span class="nav-text">ËøûÊé•Redis</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AlexiXiang</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
