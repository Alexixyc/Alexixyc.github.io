<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="study notes,">





  <link rel="alternate" href="/atom.xml" title="AlexiXiangâ€™s Blog" type="application/atom+xml">






<meta name="description" content="ç”±äºå…¬å¸Cç«¯ä¸šåŠ¡çš„ Nginx æ¡†æ¶ä½¿ç”¨çš„æ˜¯OpenRestyã€‚åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å­¦ä¹ äº† Nginx åŸºç¡€çŸ¥è¯†åï¼Œå†³å®šå†å­¦ä¹ ä¸€ä¸‹ Lua å’Œ OpenRestyã€‚æœ¬æ–‡è®°å½•äº†è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›ç¬”è®°å’Œæ€»ç»“ï¼Œå°è¯•äº†OpenRestyåœ¨æœ¬åœ°æ­å»ºç®€å•çš„API Serveræ¡†æ¶çš„demoï¼ŒåŒ…æ‹¬å¤„ç†æ¥å£è·¯ç”±ä»¥åŠæ“ä½œ Redis çš„çš„æµç¨‹ã€‚é€šè¿‡å­¦ä¹ ï¼Œæœªå°†æ¥å¯èƒ½æ¶‰åŠåˆ°OpenRestyçš„å¼€å‘åšä¸€äº›å‡†å¤‡ã€‚">
<meta name="keywords" content="study notes">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenResty &amp;&amp; Luaå­¦ä¹ ç¬”è®° ğŸ‘€">
<meta property="og:url" content="http://alexixyc.cn/2019/11/04/9openresty/index.html">
<meta property="og:site_name" content="AlexiXiangâ€™s Blog">
<meta property="og:description" content="ç”±äºå…¬å¸Cç«¯ä¸šåŠ¡çš„ Nginx æ¡†æ¶ä½¿ç”¨çš„æ˜¯OpenRestyã€‚åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å­¦ä¹ äº† Nginx åŸºç¡€çŸ¥è¯†åï¼Œå†³å®šå†å­¦ä¹ ä¸€ä¸‹ Lua å’Œ OpenRestyã€‚æœ¬æ–‡è®°å½•äº†è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›ç¬”è®°å’Œæ€»ç»“ï¼Œå°è¯•äº†OpenRestyåœ¨æœ¬åœ°æ­å»ºç®€å•çš„API Serveræ¡†æ¶çš„demoï¼ŒåŒ…æ‹¬å¤„ç†æ¥å£è·¯ç”±ä»¥åŠæ“ä½œ Redis çš„çš„æµç¨‹ã€‚é€šè¿‡å­¦ä¹ ï¼Œæœªå°†æ¥å¯èƒ½æ¶‰åŠåˆ°OpenRestyçš„å¼€å‘åšä¸€äº›å‡†å¤‡ã€‚">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://alexixyc.cn/2019/11/04/9openresty/openresty.svg">
<meta property="og:updated_time" content="2019-11-09T16:00:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenResty &amp;&amp; Luaå­¦ä¹ ç¬”è®° ğŸ‘€">
<meta name="twitter:description" content="ç”±äºå…¬å¸Cç«¯ä¸šåŠ¡çš„ Nginx æ¡†æ¶ä½¿ç”¨çš„æ˜¯OpenRestyã€‚åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å­¦ä¹ äº† Nginx åŸºç¡€çŸ¥è¯†åï¼Œå†³å®šå†å­¦ä¹ ä¸€ä¸‹ Lua å’Œ OpenRestyã€‚æœ¬æ–‡è®°å½•äº†è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›ç¬”è®°å’Œæ€»ç»“ï¼Œå°è¯•äº†OpenRestyåœ¨æœ¬åœ°æ­å»ºç®€å•çš„API Serveræ¡†æ¶çš„demoï¼ŒåŒ…æ‹¬å¤„ç†æ¥å£è·¯ç”±ä»¥åŠæ“ä½œ Redis çš„çš„æµç¨‹ã€‚é€šè¿‡å­¦ä¹ ï¼Œæœªå°†æ¥å¯èƒ½æ¶‰åŠåˆ°OpenRestyçš„å¼€å‘åšä¸€äº›å‡†å¤‡ã€‚">
<meta name="twitter:image" content="http://alexixyc.cn/2019/11/04/9openresty/openresty.svg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://alexixyc.cn/2019/11/04/9openresty/">





  <title>OpenResty && Luaå­¦ä¹ ç¬”è®° ğŸ‘€ | AlexiXiangâ€™s Blog</title>
  








<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">AlexiXiangâ€™s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br>
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://alexixyc.cn/2019/11/04/9openresty/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="AlexiXiang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AlexiXiangâ€™s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">OpenResty && Luaå­¦ä¹ ç¬”è®° ğŸ‘€</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2019-11-04T00:00:00+08:00">
                2019-11-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">æ›´æ–°äº&#58;</span>
              
              <time title="æ›´æ–°äº" itemprop="dateModified" datetime="2019-11-10T00:00:00+08:00">
                2019-11-10
              </time>
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/study-notes/" itemprop="url" rel="index">
                    <span itemprop="name">study notes</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">å­—æ•°ç»Ÿè®¡&#58;</span>
                
                <span title="å­—æ•°ç»Ÿè®¡">
                  3.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
                
                <span title="é˜…è¯»æ—¶é•¿">
                  13
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="/2019/11/04/9openresty/./openresty.svg" width="600px"><br>ç”±äºå…¬å¸Cç«¯ä¸šåŠ¡çš„ Nginx æ¡†æ¶ä½¿ç”¨çš„æ˜¯OpenRestyã€‚åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å­¦ä¹ äº† Nginx åŸºç¡€çŸ¥è¯†åï¼Œå†³å®šå†å­¦ä¹ ä¸€ä¸‹ Lua å’Œ OpenRestyã€‚æœ¬æ–‡è®°å½•äº†è‡ªå·±å­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›ç¬”è®°å’Œæ€»ç»“ï¼Œå°è¯•äº†OpenRestyåœ¨æœ¬åœ°æ­å»ºç®€å•çš„API Serveræ¡†æ¶çš„demoï¼ŒåŒ…æ‹¬å¤„ç†æ¥å£è·¯ç”±ä»¥åŠæ“ä½œ Redis çš„çš„æµç¨‹ã€‚é€šè¿‡å­¦ä¹ ï¼Œæœªå°†æ¥å¯èƒ½æ¶‰åŠåˆ°OpenRestyçš„å¼€å‘åšä¸€äº›å‡†å¤‡ã€‚</p>
<a id="more"></a>
<hr>
<h2 id="Lua"><a href="#Lua" class="headerlink" title="Lua"></a>Lua</h2><p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ã€‚æ˜¯å·´è¥¿é‡Œçº¦çƒ­å†…å¢å¤©ä¸»æ•™å¤§å­¦ï¼ˆPontifical Catholic University of Rio de Janeiroï¼‰é‡Œçš„ä¸€ä¸ªç ”ç©¶å°ç»„ï¼Œç”± Roberto Ierusalimschyã€Waldemar Celes å’Œ Luiz Henrique de Figueiredo æ‰€ç»„æˆå¹¶äº 1993 å¹´å¼€å‘ã€‚å…¶è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚Lua ç”±æ ‡å‡† C ç¼–å†™è€Œæˆï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½å¯ä»¥ç¼–è¯‘ã€è¿è¡Œã€‚Lua å¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œè¿™æ˜¯ç”±å®ƒçš„å®šä½å†³å®šçš„ã€‚æ‰€ä»¥ Lua ä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ã€‚Lua æœ‰ä¸€ä¸ªåŒæ—¶è¿›è¡Œçš„ JIT é¡¹ç›®ï¼Œæä¾›åœ¨ç‰¹å®šå¹³å°ä¸Šçš„å³æ—¶ç¼–è¯‘åŠŸèƒ½ã€‚</p>
<p>Lua è„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢« C/C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨ C/C++ çš„å‡½æ•°ï¼Œè¿™ä½¿å¾— Lua åœ¨åº”ç”¨ç¨‹åºä¸­å¯ä»¥è¢«å¹¿æ³›åº”ç”¨ã€‚ä¸ä»…ä»…ä½œä¸ºæ‰©å±•è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºæ™®é€šçš„é…ç½®æ–‡ä»¶ï¼Œä»£æ›¿ XMLã€ini ç­‰æ–‡ä»¶æ ¼å¼ï¼Œå¹¶ä¸”æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚æ ‡å‡† Lua 5.1 è§£é‡Šå™¨ç”±æ ‡å‡† C ç¼–å†™è€Œæˆï¼Œä»£ç ç®€æ´ä¼˜ç¾ï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½å¯ä»¥ç¼–è¯‘å’Œè¿è¡Œï¼›ä¸€ä¸ªå®Œæ•´çš„æ ‡å‡† Lua 5.1 è§£é‡Šå™¨ä¸è¶³ 200KBã€‚è€Œæœ¬ä¹¦æ¨èä½¿ç”¨çš„ LuaJIT 2 çš„ä»£ç å¤§å°ä¹Ÿåªæœ‰ä¸è¶³ 500KBï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¤§éƒ¨åˆ†å¸¸è§çš„ä½“ç³»ç»“æ„ã€‚åœ¨ç›®å‰æ‰€æœ‰è„šæœ¬è¯­è¨€å¼•æ“ä¸­ï¼ŒLuaJIT 2 å®ç°çš„é€Ÿåº¦åº”è¯¥ç®—æ˜¯æœ€å¿«çš„ä¹‹ä¸€ã€‚è¿™ä¸€åˆ‡éƒ½å†³å®šäº† Lua æ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬çš„æœ€ä½³é€‰æ‹©ã€‚</p>
<p>Lua è¯­è¨€çš„å„ä¸ªç‰ˆæœ¬æ˜¯ä¸ç›¸å…¼å®¹çš„ã€‚å› æ­¤æœ¬ä¹¦åªä»‹ç» Lua 5.1 è¯­è¨€ï¼Œè¿™æ˜¯ä¸ºæ ‡å‡† Lua 5.1 è§£é‡Šå™¨å’Œ LuaJIT 2 æ‰€å…±åŒæ”¯æŒçš„ã€‚LuaJIT æ”¯æŒçš„å¯¹ Lua 5.1 å‘åå…¼å®¹çš„ Lua 5.2 å’Œ Lua 5.3 çš„ç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåœ¨æ–¹ä¾¿çš„æ—¶å€™äºˆä»¥ä»‹ç»ã€‚</p>
<p><a href="https://www.jianshu.com/p/70769e81d6cf" target="_blank" rel="noopener">å®‰è£…LuaJITé‡åˆ°çš„é—®é¢˜</a></p>
<h3 id="LuaåŸºç¡€æ•°æ®ç±»å‹"><a href="#LuaåŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="LuaåŸºç¡€æ•°æ®ç±»å‹"></a>LuaåŸºç¡€æ•°æ®ç±»å‹</h3><ul>
<li>nilï¼ˆç©ºï¼‰ï¼šnil æ˜¯ä¸€ç§ç±»å‹ï¼ŒLua å°† nil ç”¨äºè¡¨ç¤ºâ€œæ— æ•ˆå€¼â€ã€‚ä¸€ä¸ªå˜é‡åœ¨ç¬¬ä¸€æ¬¡èµ‹å€¼å‰çš„é»˜è®¤å€¼æ˜¯ nilï¼Œå°† nil èµ‹äºˆç»™ä¸€ä¸ªå…¨å±€å˜é‡å°±ç­‰åŒäºåˆ é™¤å®ƒã€‚</li>
<li>booleanï¼ˆå¸ƒå°”ï¼‰ï¼šå¯é€‰å€¼ true/falseï¼›Lua ä¸­ nil å’Œ false ä¸ºâ€œå‡â€ï¼Œå…¶å®ƒæ‰€æœ‰å€¼å‡ä¸ºâ€œçœŸâ€ã€‚<strong>ï¼ˆ0å’Œç©ºå­—ç¬¦ä¸²æ˜¯â€çœŸâ€ï¼‰</strong></li>
<li>numberï¼ˆæ•°å­—ï¼‰</li>
<li>stringï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
<li>table (è¡¨)ï¼šTable ç±»å‹å®ç°äº†ä¸€ç§æŠ½è±¡çš„â€œå…³è”æ•°ç»„â€ï¼Œé€šå¸¸å®ç°ä¸ºä¸€ä¸ªå“ˆå¸Œè¡¨ã€ä¸€ä¸ªæ•°ç»„ã€æˆ–è€…ä¸¤è€…çš„æ··åˆã€‚</li>
<li>function (å‡½æ•°)ï¼šåœ¨ Lua ä¸­ï¼Œå‡½æ•° ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå‡½æ•°å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œå¯ä»¥é€šè¿‡å‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œè¿˜å¯ä»¥ä½œä¸ºå…¶ä»–å‡½æ•°çš„è¿”å›å€¼ã€‚</li>
</ul>
<h3 id="Luaè¡¨è¾¾å¼"><a href="#Luaè¡¨è¾¾å¼" class="headerlink" title="Luaè¡¨è¾¾å¼"></a>Luaè¡¨è¾¾å¼</h3><ul>
<li>ç®—æœ¯è¿ç®—ç¬¦ï¼š + - * / ^ %</li>
<li>å…³ç³»è¿ç®—ç¬¦ï¼š &lt; &gt; &lt;= &gt;= == ~=(ä¸ç­‰äº)<blockquote>
<p>Lua å­—ç¬¦ä¸²æ€»æ˜¯ä¼šè¢«â€œå†…åŒ–â€ï¼Œå³ç›¸åŒå†…å®¹çš„å­—ç¬¦ä¸²åªä¼šè¢«ä¿å­˜ä¸€ä»½ï¼Œå› æ­¤ Lua å­—ç¬¦ä¸²ä¹‹é—´çš„ç›¸ç­‰æ€§æ¯”è¾ƒå¯ä»¥ç®€åŒ–ä¸ºå…¶å†…éƒ¨å­˜å‚¨åœ°å€çš„æ¯”è¾ƒã€‚è¿™æ„å‘³ç€ Lua å­—ç¬¦ä¸²çš„ç›¸ç­‰æ€§æ¯”è¾ƒæ€»æ˜¯ä¸º O(1). è€Œåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå­—ç¬¦ä¸²çš„ç›¸ç­‰æ€§æ¯”è¾ƒåˆ™é€šå¸¸ä¸º O(n)ï¼Œå³éœ€è¦é€ä¸ªå­—èŠ‚ï¼ˆæˆ–æŒ‰è‹¥å¹²ä¸ªè¿ç»­å­—èŠ‚ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚</p>
</blockquote>
</li>
<li>é€»è¾‘è¿ç®—ç¬¦ï¼š and(ä¸) or(æˆ–) not(é)  ï¼ˆå¯¹äº notï¼Œæ°¸è¿œåªè¿”å› true æˆ–è€… falseï¼‰</li>
</ul>
<h3 id="æ§åˆ¶ç»“æ„"><a href="#æ§åˆ¶ç»“æ„" class="headerlink" title="æ§åˆ¶ç»“æ„"></a>æ§åˆ¶ç»“æ„</h3><ul>
<li><p>if/else</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">score = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> score == <span class="number">100</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Very good!Your score is 100"</span>)</span><br><span class="line"><span class="keyword">elseif</span> score &gt;= <span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Congratulations, you have passed it,your score greater or equal to 60"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> score &gt; <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Your score is better than 0"</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"My God, your score turned out to be 0"</span>)</span><br><span class="line">    <span class="keyword">end</span> <span class="comment">--ä¸ä¸Šä¸€ç¤ºä¾‹ä»£ç ä¸åŒçš„æ˜¯ï¼Œæ­¤å¤„è¦æ·»åŠ ä¸€ä¸ªend</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>while</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> t = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">18</span>, <span class="number">21</span>&#125;</span><br><span class="line"><span class="keyword">local</span> i</span><br><span class="line"><span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(t) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">11</span> == v <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"index["</span> .. i .. <span class="string">"] have right value[11]"</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h3><p>ä¸€ä¸ª Lua æ¨¡å—çš„æ•°æ®ç»“æ„æ˜¯ç”¨ä¸€ä¸ª Lua å€¼ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª Lua è¡¨æˆ–è€… Lua å‡½æ•°ï¼‰ã€‚ä¸€ä¸ª Lua æ¨¡å—ä»£ç å°±æ˜¯ä¸€ä¸ªä¼šè¿”å›è¿™ä¸ª Lua å€¼çš„ä»£ç å—ã€‚ å¯ä»¥ä½¿ç”¨å†…å»ºå‡½æ•° require() æ¥åŠ è½½å’Œç¼“å­˜æ¨¡å—ã€‚ç®€å•çš„è¯´ï¼Œä¸€ä¸ªä»£ç æ¨¡å—å°±æ˜¯ä¸€ä¸ªç¨‹åºåº“ï¼Œå¯ä»¥é€šè¿‡ require æ¥åŠ è½½ã€‚æ¨¡å—åŠ è½½åçš„ç»“æœé€šè¿‡æ˜¯ä¸€ä¸ª Lua tableï¼Œè¿™ä¸ªè¡¨å°±åƒæ˜¯ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå…¶å†…å®¹å°±æ˜¯æ¨¡å—ä¸­å¯¼å‡ºçš„æ‰€æœ‰ä¸œè¥¿ï¼Œæ¯”å¦‚å‡½æ•°å’Œå˜é‡ã€‚require å‡½æ•°ä¼šè¿”å› Lua æ¨¡å—åŠ è½½åçš„ç»“æœï¼Œå³ç”¨äºè¡¨ç¤ºè¯¥ Lua æ¨¡å—çš„ Lua å€¼ã€‚</p>
<h2 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h2><p>OpenRestyÂ® æ˜¯ä¸€ä¸ªåŸºäº Nginx ä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚</p>
<p>OpenRestyÂ® é€šè¿‡æ±‡èšå„ç§è®¾è®¡ç²¾è‰¯çš„ Nginx æ¨¡å—ï¼ˆä¸»è¦ç”± OpenResty å›¢é˜Ÿè‡ªä¸»å¼€å‘ï¼‰ï¼Œä»è€Œå°† Nginx æœ‰æ•ˆåœ°å˜æˆä¸€ä¸ªå¼ºå¤§çš„é€šç”¨ Web åº”ç”¨å¹³å°ã€‚è¿™æ ·ï¼ŒWeb å¼€å‘äººå‘˜å’Œç³»ç»Ÿå·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬è¯­è¨€è°ƒåŠ¨ Nginx æ”¯æŒçš„å„ç§ C ä»¥åŠ Lua æ¨¡å—ï¼Œå¿«é€Ÿæ„é€ å‡ºè¶³ä»¥èƒœä»» 10K ä¹ƒè‡³ 1000K ä»¥ä¸Šå•æœºå¹¶å‘è¿æ¥çš„é«˜æ€§èƒ½ Web åº”ç”¨ç³»ç»Ÿã€‚</p>
<p>OpenRestyÂ® çš„ç›®æ ‡æ˜¯è®©ä½ çš„WebæœåŠ¡ç›´æ¥è·‘åœ¨ Nginx æœåŠ¡å†…éƒ¨ï¼Œå……åˆ†åˆ©ç”¨ Nginx çš„éé˜»å¡ I/O æ¨¡å‹ï¼Œä¸ä»…ä»…å¯¹ HTTP å®¢æˆ·ç«¯è¯·æ±‚,ç”šè‡³äºå¯¹è¿œç¨‹åç«¯è¯¸å¦‚ MySQLã€PostgreSQLã€Memcached ä»¥åŠ Redis ç­‰éƒ½è¿›è¡Œä¸€è‡´çš„é«˜æ€§èƒ½å“åº”ã€‚</p>
<p><a href="https://moonbingbing.gitbooks.io/openresty-best-practices/lua/class.html" target="_blank" rel="noopener">gitbook</a></p>
<h3 id="ä¸locationé…åˆ"><a href="#ä¸locationé…åˆ" class="headerlink" title="ä¸locationé…åˆ"></a>ä¸locationé…åˆ</h3><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">location = /sum &#123;</span><br><span class="line">    # åªå…è®¸å†…éƒ¨è°ƒç”¨</span><br><span class="line">    internal;</span><br><span class="line"></span><br><span class="line">    # è¿™é‡Œåšäº†ä¸€ä¸ªæ±‚å’Œè¿ç®—åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥åœ¨è¿™é‡Œå®Œæˆä¸€äº›æ•°æ®åº“ã€</span><br><span class="line">    # ç¼“å­˜æœåŠ¡å™¨çš„æ“ä½œï¼Œè¾¾åˆ°åŸºç¡€æ¨¡å—å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»ç›®çš„</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">        ngx.say(<span class="built_in">tonumber</span>(args.a) + <span class="built_in">tonumber</span>(args.b))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /subduction &#123;</span><br><span class="line">    internal;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">        ngx.<span class="built_in">print</span>(<span class="built_in">tonumber</span>(args.a) - <span class="built_in">tonumber</span>(args.b))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /app/test_parallels &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> start_time = ngx.now()</span><br><span class="line">        <span class="keyword">local</span> res1, res2 = ngx.location.capture_multi( &#123;</span><br><span class="line">                        &#123;<span class="string">"/sum"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;,</span><br><span class="line">                        &#123;<span class="string">"/subduction"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res1.<span class="built_in">status</span>, <span class="string">" response:"</span>, res1.body)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res2.<span class="built_in">status</span>, <span class="string">" response:"</span>, res2.body)</span><br><span class="line">        ngx.say(<span class="string">"time used:"</span>, ngx.now() - start_time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /app/test_queue &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> start_time = ngx.now()</span><br><span class="line">        <span class="keyword">local</span> res1 = ngx.location.capture_multi( &#123;</span><br><span class="line">                        &#123;<span class="string">"/sum"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        <span class="keyword">local</span> res2 = ngx.location.capture_multi( &#123;</span><br><span class="line">                        &#123;<span class="string">"/subduction"</span>, &#123;args=&#123;a=<span class="number">3</span>, b=<span class="number">8</span>&#125;&#125;&#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res1.<span class="built_in">status</span>, <span class="string">" response:"</span>, res1.body)</span><br><span class="line">        ngx.say(<span class="string">"status:"</span>, res2.<span class="built_in">status</span>, <span class="string">" response:"</span>, res2.body)</span><br><span class="line">        ngx.say(<span class="string">"time used:"</span>, ngx.now() - start_time)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ ngx.location.capture_multi å‡½æ•°ï¼Œç›´æ¥å®Œæˆäº†ä¸¤ä¸ªå­è¯·æ±‚å¹¶è¡Œæ‰§è¡Œã€‚å½“ä¸¤ä¸ªè¯·æ±‚æ²¡æœ‰ç›¸äº’ä¾èµ–ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥æå¤§æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</p>
<h3 id="è·å–uriå‚æ•°"><a href="#è·å–uriå‚æ•°" class="headerlink" title="è·å–uriå‚æ•°"></a>è·å–uriå‚æ•°</h3><h4 id="è·å–è¯·æ±‚uriå‚æ•°"><a href="#è·å–è¯·æ±‚uriå‚æ•°" class="headerlink" title="è·å–è¯·æ±‚uriå‚æ•°"></a>è·å–è¯·æ±‚uriå‚æ•°</h4><ul>
<li>æ–¹æ³•<code>ngx.req.get_uri_args</code>ï¼šè·å–æ¥è‡ª uri è¯·æ±‚çš„å‚æ•°</li>
<li>æ–¹æ³•<code>ngx.req.get_post_args</code>ï¼šè·å–æ¥è‡ª post è¯·æ±‚çš„å†…å®¹<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location /print_param &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> <span class="built_in">arg</span> = ngx.req.get_uri_args()</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">            ngx.say(<span class="string">"[GET ] key:"</span>, k, <span class="string">" v:"</span>, v)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        ngx.req.read_body() <span class="comment">-- è§£æ body å‚æ•°ä¹‹å‰ä¸€å®šè¦å…ˆè¯»å– body</span></span><br><span class="line">        <span class="keyword">local</span> <span class="built_in">arg</span> = ngx.req.get_post_args()</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> <span class="built_in">pairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">            ngx.say(<span class="string">"[POST] key:"</span>, k, <span class="string">" v:"</span>, v)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="ä¼ é€’è¯·æ±‚uriå‚æ•°"><a href="#ä¼ é€’è¯·æ±‚uriå‚æ•°" class="headerlink" title="ä¼ é€’è¯·æ±‚uriå‚æ•°"></a>ä¼ é€’è¯·æ±‚uriå‚æ•°</h4><ul>
<li>æ–¹æ³•<code>ngx.encode_args</code>ï¼šè¿›è¡Œè§„åˆ™è½¬ä¹‰<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location /test &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> res = ngx.location.capture(</span><br><span class="line">                <span class="string">'/print_param'</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                    method = ngx.HTTP_POST,</span><br><span class="line">                    args = ngx.encode_args(&#123;a = <span class="number">1</span>, b = <span class="string">'2&amp;'</span>&#125;),</span><br><span class="line">                    body = ngx.encode_args(&#123;c = <span class="number">3</span>, d = <span class="string">'4&amp;'</span>&#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line">        ngx.say(res.body)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="è·å–è¯·æ±‚body"><a href="#è·å–è¯·æ±‚body" class="headerlink" title="è·å–è¯·æ±‚body"></a>è·å–è¯·æ±‚body</h3><p>åœ¨ Nginx çš„å…¸å‹åº”ç”¨åœºæ™¯ä¸­ï¼Œå‡ ä¹éƒ½æ˜¯åªè¯»å– HTTP å¤´å³å¯ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æ­£åå‘ä»£ç†ç­‰åœºæ™¯ã€‚ä½†æ˜¯å¯¹äº API Server æˆ–è€… Web Application ï¼Œå¯¹ body å¯ä»¥è¯´å°±æ¯”è¾ƒæ•æ„Ÿäº†ã€‚ç”±äº OpenResty åŸºäº Nginx ï¼Œæ‰€ä»¥å¤©ç„¶çš„å¯¹è¯·æ±‚ body çš„è¯»å–ç»†èŠ‚ä¸å…¶ä»–æˆç†Ÿ Web æ¡†æ¶æœ‰äº›ä¸åŒã€‚                                                                   </p>
<ul>
<li>æ–¹æ³•<code>ngx.req.get_body_data</code>ï¼šè·å–è¯·æ±‚çš„bodyéƒ¨åˆ†<blockquote>
<p>æ³¨æ„ï¼šè·å–bodyéƒ¨åˆ†éœ€è¦æ·»åŠ æŒ‡ä»¤ <code>lua_need_request_body on;</code>ï¼Œå› ä¸ºä¸»è¦æ˜¯ Nginx è¯ç”Ÿä¹‹åˆä¸»è¦æ˜¯ä¸ºäº†è§£å†³è´Ÿè½½å‡è¡¡æƒ…å†µï¼Œè€Œè¿™ç§æƒ…å†µï¼Œæ˜¯ä¸éœ€è¦è¯»å– body å°±å¯ä»¥å†³å®šè´Ÿè½½ç­–ç•¥çš„ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¸èƒ½è·å–è¯·æ±‚ä½“çš„ï¼›</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># é»˜è®¤è¯»å– body</span><br><span class="line">lua_need_request_body on;</span><br><span class="line"></span><br><span class="line">location /test &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        <span class="keyword">local</span> data = ngx.req.get_body_data()</span><br><span class="line">        ngx.say(<span class="string">"hello "</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p>å¦‚æœä½ åªæ˜¯æŸä¸ªæ¥å£éœ€è¦è¯»å– bodyï¼ˆå¹¶éå…¨å±€è¡Œä¸ºï¼‰ï¼Œé‚£ä¹ˆè¿™æ—¶å€™ä¹Ÿå¯ä»¥æ˜¾ç¤ºè°ƒç”¨ <code>ngx.req.read_body()</code> æ¥å£ï¼š<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location /test &#123;</span><br><span class="line">    content_by_lua_block &#123;</span><br><span class="line">        ngx.req.read_body()</span><br><span class="line">        <span class="keyword">local</span> data = ngx.req.get_body_data()</span><br><span class="line">        ngx.say(<span class="string">"hello "</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="è¾“å‡ºå“åº”ä½“"><a href="#è¾“å‡ºå“åº”ä½“" class="headerlink" title="è¾“å‡ºå“åº”ä½“"></a>è¾“å‡ºå“åº”ä½“</h3><p>åœ¨OpenResty ä¸­è°ƒç”¨<code>ngx.say</code> ä¸ <code>ngx.print</code>å¯ä»¥è¾“å‡ºå“åº”ä½“ï¼ŒäºŒè€…åŒºåˆ«åœ¨äºï¼š<code>ngx.say</code> è¾“å‡ºçš„å“åº”ä½“ä¼šå¤šä¸€ä¸ªæ¢è¡Œç¬¦ \nã€‚</p>
<blockquote>
<p>æ³¨æ„<code>ngx.say</code> ä¸ <code>ngx.print</code> éƒ½æ˜¯å¼‚æ­¥è¾“å‡º</p>
</blockquote>
<h4 id="å¤„ç†å“åº”ä½“è¿‡å¤§çš„è¾“å‡º"><a href="#å¤„ç†å“åº”ä½“è¿‡å¤§çš„è¾“å‡º" class="headerlink" title="å¤„ç†å“åº”ä½“è¿‡å¤§çš„è¾“å‡º"></a>å¤„ç†å“åº”ä½“è¿‡å¤§çš„è¾“å‡º</h4><ul>
<li><p>è¾“å‡ºå†…å®¹æœ¬èº«ä½“ç§¯å¾ˆå¤§ï¼Œä¾‹å¦‚è¶…è¿‡ 2G çš„æ–‡ä»¶ä¸‹è½½<br>åˆ©ç”¨ HTTP 1.1 ç‰¹æ€§ CHUNKED ç¼–ç ï¼ŒæŠŠä¸€ä¸ªå¤§çš„å“åº”ä½“æ‹†åˆ†æˆå¤šä¸ªå°çš„åº”ç­”ä½“ï¼Œåˆ†æ‰¹ã€æœ‰èŠ‚åˆ¶çš„å“åº”ç»™è¯·æ±‚æ–¹ã€‚</p>
</li>
<li><p>è¾“å‡ºå†…å®¹æœ¬èº«æ˜¯ç”±å„ç§ç¢ç‰‡æ‹¼å‡‘çš„ï¼Œç¢ç‰‡æ•°é‡åºå¤§ï¼Œä¾‹å¦‚åº”ç­”æ•°æ®æ˜¯æŸåœ°åŒºæ‰€æœ‰äººçš„å§“å<br>åˆ©ç”¨ ngx.print è¾“å…¥å‚æ•°å¯ä»¥æ˜¯å•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ table å¯¹è±¡çš„è¿™ä¸€ç‰¹æ€§ï¼ŒæŠŠç¢ç‰‡æ•°æ®ç›´æ¥å­˜æ”¾åœ¨ table ä¸­ï¼Œç”¨æ•°ç»„çš„æ–¹å¼æŠŠè¿™äº›ç¢ç‰‡æ•°æ®ç»Ÿä¸€èµ·æ¥ï¼Œç›´æ¥è°ƒç”¨ ngx.print(tableï¼‰å³å¯ã€‚</p>
</li>
</ul>
<h3 id="ç®€å•API-Serveræ¡†æ¶"><a href="#ç®€å•API-Serveræ¡†æ¶" class="headerlink" title="ç®€å•API Serveræ¡†æ¶"></a>ç®€å•API Serveræ¡†æ¶</h3><ul>
<li>é¦–å…ˆï¼Œé…ç½®å¤šä¸ªAPIæ—¶ï¼Œä¸ºäº†ä¿æŒ nginx é…ç½®æ–‡ä»¶çš„ç®€æ´ï¼Œè¦æŠŠè¿™äº›æ¥å£çš„å®ç°æ”¾åˆ°å„è‡ªçš„ç‹¬ç«‹<code>lua</code>æ–‡ä»¶ä¸­ï¼›</li>
<li>å…¶æ¬¡ï¼Œå¯¹æ¯ä¸ª API éƒ½å†™ä¸€ä¸ª locationä¼šè®©Nginxé…ç½®å˜å¾—å¤æ‚ï¼Œæ‰€ä»¥éœ€è¦æŠŠå®ƒä»¬éƒ½åˆå¹¶åˆ°ä¸€ä¸ªlocationé…ç½®ä¸­ï¼›</li>
</ul>
<p>é¦–å…ˆï¼Œå®šä¹‰luaæ–‡ä»¶æœç´¢è·¯å¾„ï¼Œè®¾ç½®locationæ­£åˆ™åŒ¹é…ï¼Œæ ¹æ®åŒ¹é…åˆ°çš„è·¯ç”±åç§°æŒ‡å‘å¯¹åº”çš„luaæ–‡ä»¶ï¼›<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">    # è®¾ç½®é»˜è®¤ lua æœç´¢è·¯å¾„ï¼Œæ·»åŠ  lua è·¯å¾„</span><br><span class="line">    # æ­¤å¤„å†™ç›¸å¯¹è·¯å¾„æ—¶ï¼Œå¯¹å¯åŠ¨ nginx çš„è·¯å¾„æœ‰è¦æ±‚ï¼Œå¿…é¡»åœ¨ nginx ç›®å½•ä¸‹å¯åŠ¨ï¼Œ<span class="built_in">require</span> æ‰¾ä¸åˆ°</span><br><span class="line">    # comm.param ç»å¯¹è·¯å¾„å½“ç„¶ä¹Ÿæ²¡é—®é¢˜ï¼Œä½†æ˜¯ä¸å¯ç§»æ¤ï¼Œå› æ­¤åº”ä½¿ç”¨å˜é‡ $prefix æˆ–</span><br><span class="line">    # $&#123;prefix&#125;ï¼ŒOR ä¼šæ›¿æ¢ä¸º nginx çš„ prefix <span class="built_in">path</span></span><br><span class="line">    # lua_package_path <span class="string">'lua/?.lua;/blah/?.lua;;'</span>;</span><br><span class="line">    lua_package_path <span class="string">'$prefix/lua/?.lua;/blah/?.lua;;'</span>;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen <span class="number">80</span>;</span><br><span class="line">        location ~ ^/api/([-_a-zA-Z0<span class="number">-9</span>/]+) &#123;</span><br><span class="line">            # å‡†å…¥é˜¶æ®µå®Œæˆå‚æ•°éªŒè¯ (æ–­è¨€ï¼Ÿï¼Ÿ)</span><br><span class="line">            access_by_lua_file  lua/access_check.lua;</span><br><span class="line">            #å†…å®¹ç”Ÿæˆé˜¶æ®µ</span><br><span class="line">            content_by_lua_file lua/$<span class="number">1.</span>lua;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒæ­¥ï¼Œæ–°å»ºå®ç°æ¥å£çš„luaæ–‡ä»¶ï¼Œç¼–å†™æ¥å£é€»è¾‘ï¼Œè¾“å‡ºå“åº”ä½“ï¼›<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--========== &#123;$prefix&#125;/lua/addition.lua</span></span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line">ngx.say(args.a + args.b)</span><br></pre></td></tr></table></figure></p>
<p>æœ€åï¼Œè¿˜å¯ä»¥åŠ ä¸€ä¸ªå‚æ•°çš„æ£€æŸ¥éªŒè¯çš„é€»è¾‘ï¼›<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--========== &#123;$prefix&#125;/lua/comm/param.lua</span></span><br><span class="line"><span class="keyword">local</span> _M = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¯¹è¾“å…¥å‚æ•°é€ä¸ªè¿›è¡Œæ ¡éªŒï¼Œåªè¦æœ‰ä¸€ä¸ªä¸æ˜¯æ•°å­—ç±»å‹ï¼Œåˆ™è¿”å› false</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_M.is_number</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">arg</span> = &#123;...&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> num</span><br><span class="line">    <span class="keyword">for</span> _,v <span class="keyword">in</span> <span class="built_in">ipairs</span>(<span class="built_in">arg</span>) <span class="keyword">do</span></span><br><span class="line">        num = <span class="built_in">tonumber</span>(v)</span><br><span class="line">        <span class="keyword">if</span> <span class="literal">nil</span> == num <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> _M</span><br><span class="line"></span><br><span class="line"><span class="comment">--========== &#123;$prefix&#125;/lua/access_check.lua</span></span><br><span class="line"><span class="keyword">local</span> param= <span class="built_in">require</span>(<span class="string">"comm.param"</span>)</span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> args.a <span class="keyword">or</span> <span class="keyword">not</span> args.b <span class="keyword">or</span> <span class="keyword">not</span> param.is_number(args.a, args.b) <span class="keyword">then</span></span><br><span class="line">    ngx.<span class="built_in">exit</span>(ngx.HTTP_BAD_REQUEST)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<h3 id="å­æŸ¥è¯¢"><a href="#å­æŸ¥è¯¢" class="headerlink" title="å­æŸ¥è¯¢"></a>å­æŸ¥è¯¢</h3><p>Nginx å­è¯·æ±‚æ˜¯ä¸€ç§éå¸¸å¼ºæœ‰åŠ›çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥å‘èµ·éé˜»å¡çš„å†…éƒ¨è¯·æ±‚è®¿é—®ç›®æ ‡ locationã€‚ä½†æ˜¯å­è¯·æ±‚åªæ˜¯æ¨¡æ‹Ÿ HTTP æ¥å£çš„å½¢å¼ï¼Œ æ²¡æœ‰é¢å¤–çš„ HTTP/TCP æµé‡ï¼Œä¹Ÿæ²¡æœ‰ IPC (è¿›ç¨‹é—´é€šä¿¡) è°ƒç”¨ï¼Œæ‰€æœ‰å·¥ä½œåœ¨å†…éƒ¨é«˜æ•ˆåœ°åœ¨ C è¯­è¨€çº§åˆ«å®Œæˆã€‚APIæ–¹æ³•<code>ngx.location.capture</code>å’Œ<code>ngx.location.capture_multi</code>ã€‚</p>
<h3 id="è¿æ¥Redis"><a href="#è¿æ¥Redis" class="headerlink" title="è¿æ¥Redis"></a>è¿æ¥Redis</h3><p>é¦–å…ˆå°†è¿æ¥Redisçš„æ–¹æ³•å°è£…åœ¨redisæ–‡ä»¶å¤¹ä¸‹çš„main.luaä¸­ï¼Œå¹¶å¯¼å‡ºredisè¿æ¥å®ä¾‹å¯¹è±¡ï¼š<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Redis = &#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Redis.connect</span><span class="params">()</span></span></span><br><span class="line">  <span class="comment">-- å¼•å…¥redisåŒ…</span></span><br><span class="line">  <span class="keyword">local</span> redis = <span class="built_in">require</span> <span class="string">"resty.redis"</span></span><br><span class="line">  <span class="comment">-- åˆ›å»ºæ–°çš„redisè¿æ¥</span></span><br><span class="line">  <span class="keyword">local</span> red = redis:new()</span><br><span class="line">  <span class="comment">-- è®¾ç½®redisè¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">  red:set_timeout(<span class="number">1000</span>) <span class="comment">-- 1 sec</span></span><br><span class="line">  <span class="comment">-- é€šè¿‡ipåœ°å€å’Œç«¯å£å»ºç«‹è¿æ¥</span></span><br><span class="line">  <span class="keyword">local</span> ok, err = red:connect(<span class="string">"127.0.0.1"</span>, <span class="number">6379</span>)</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">      ngx.say(<span class="string">"failed to connect: "</span>, err)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">return</span> red</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">return</span> Redis</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åå†æ–°å»ºä¸€ä¸ªredisæ“ä½œæ–‡ä»¶ï¼Œå¼•ç”¨ä¸Šé¢å¯¼å‡ºçš„redisè¿æ¥å¯¹è±¡ï¼Œåšä¸€äº›å¯¹é”®å€¼å¯¹çš„ set å’Œ get æ“ä½œï¼ˆå…¶å®ï¼Œè¿˜å¯ä»¥å•ç‹¬å°è£…setã€getæ–¹æ³•ï¼‰ï¼Œå°è¯•æ“ä½œ redisï¼š<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> Redis = <span class="built_in">require</span>(<span class="string">"redis.main"</span>) <span class="comment">-- å¼•ç”¨ä¸Šé¢å¯¼å‡ºçš„redisè¿æ¥å¯¹è±¡</span></span><br><span class="line"><span class="keyword">local</span> red = Redis.connect() <span class="comment">-- è°ƒç”¨connectè¿æ¥æ–¹æ³•</span></span><br><span class="line"><span class="comment">-- è·å–urlå‚æ•°</span></span><br><span class="line"><span class="keyword">local</span> args = ngx.req.get_uri_args()</span><br><span class="line"><span class="keyword">local</span> key = args.key</span><br><span class="line"><span class="keyword">local</span> value = args.value</span><br><span class="line"></span><br><span class="line"><span class="comment">-- setä¸€ä¸ªé”®å€¼å¯¹</span></span><br><span class="line">ok, err = red:set(key, value)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">"failed to set key: "</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">ngx.say(<span class="string">"set "</span>, key, <span class="string">": "</span>, ok)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å–å‡ºåˆšåˆšsetçš„é”®å€¼å¯¹</span></span><br><span class="line"><span class="keyword">local</span> res, err = red:get(key)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> res <span class="keyword">then</span></span><br><span class="line">    ngx.say(<span class="string">"failed to get key: "</span>, err)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">ngx.say(<span class="string">"get "</span>, key, <span class="string">": "</span>, res)</span><br></pre></td></tr></table></figure></p>
<p>æœ€åï¼Œåœ¨Nginx.confé‡Œé…ç½®locationçš„Luaä»£ç å—ï¼š<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~ ^<span class="regexp">/api/</span>([-_a-zA-Z0<span class="number">-9</span>/]+) &#123;</span><br><span class="line">    access_by_lua_file  lua/access_check.lua;</span><br><span class="line">    content_by_lua_file lua/$<span class="number">1.</span>lua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<!-- reloadï¼š nginx -p `pwd`/ -c conf/nginx.conf -s reload
æŸ¥çœ‹ï¼šps -ef | grep nginx -->
      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>â†˜â†˜ğŸ‘»æˆ‘ä¸è¦è„¸ğŸ‘»â†™â†™</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>æ‰“èµ</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="AlexiXiang å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="AlexiXiang æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/study-notes/" rel="tag"># study notes</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/10/10/8nginx/" rel="next" title="Nginx ç›¸å…³çŸ¥è¯†ç‚¹æ€»ç»“ğŸ‘€">
                <i class="fa fa-chevron-left"></i> Nginx ç›¸å…³çŸ¥è¯†ç‚¹æ€»ç»“ğŸ‘€
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/11/15/10vue-modal-manager/" rel="prev" title="VueModalManager â€”â€” ç§»åŠ¨ç«¯å…¨å±å¼¹çª—ç®¡ç†æ’ä»¶">
                VueModalManager â€”â€” ç§»åŠ¨ç«¯å…¨å±å¼¹çª—ç®¡ç†æ’ä»¶ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNDM3My8xMDkxMA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="AlexiXiang">
            
              <p class="site-author-name" itemprop="name">AlexiXiang</p>
              <p class="site-description motion-element" itemprop="description">Look ahead to the day you die.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">æ—¥å¿—</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">åˆ†ç±»</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">æ ‡ç­¾</span>
                
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Alexixyc" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:alexixyc@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/profile.php?id=100019367790425" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.youtube.com/channel/UC6UTrplKuiGOwuqF4znDWAg?view_as=subscriber" target="_blank" title="YouTube">
                      
                        <i class="fa fa-fw fa-youtube"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.instagram.com/alexi_xiang/" target="_blank" title="Instagram">
                      
                        <i class="fa fa-fw fa-instagram"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://dribbble.com/alexi_xiang" target="_blank" title="dribbble">
                      
                        <i class="fa fa-fw fa-dribbble"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lua"><span class="nav-number">1.</span> <span class="nav-text">Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LuaåŸºç¡€æ•°æ®ç±»å‹"><span class="nav-number">1.1.</span> <span class="nav-text">LuaåŸºç¡€æ•°æ®ç±»å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Luaè¡¨è¾¾å¼"><span class="nav-number">1.2.</span> <span class="nav-text">Luaè¡¨è¾¾å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ§åˆ¶ç»“æ„"><span class="nav-number">1.3.</span> <span class="nav-text">æ§åˆ¶ç»“æ„</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¨¡å—"><span class="nav-number">1.4.</span> <span class="nav-text">æ¨¡å—</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenResty"><span class="nav-number">2.</span> <span class="nav-text">OpenResty</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸locationé…åˆ"><span class="nav-number">2.1.</span> <span class="nav-text">ä¸locationé…åˆ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–uriå‚æ•°"><span class="nav-number">2.2.</span> <span class="nav-text">è·å–uriå‚æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#è·å–è¯·æ±‚uriå‚æ•°"><span class="nav-number">2.2.1.</span> <span class="nav-text">è·å–è¯·æ±‚uriå‚æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¼ é€’è¯·æ±‚uriå‚æ•°"><span class="nav-number">2.2.2.</span> <span class="nav-text">ä¼ é€’è¯·æ±‚uriå‚æ•°</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è·å–è¯·æ±‚body"><span class="nav-number">2.3.</span> <span class="nav-text">è·å–è¯·æ±‚body</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¾“å‡ºå“åº”ä½“"><span class="nav-number">2.4.</span> <span class="nav-text">è¾“å‡ºå“åº”ä½“</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤„ç†å“åº”ä½“è¿‡å¤§çš„è¾“å‡º"><span class="nav-number">2.4.1.</span> <span class="nav-text">å¤„ç†å“åº”ä½“è¿‡å¤§çš„è¾“å‡º</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç®€å•API-Serveræ¡†æ¶"><span class="nav-number">2.5.</span> <span class="nav-text">ç®€å•API Serveræ¡†æ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å­æŸ¥è¯¢"><span class="nav-number">2.6.</span> <span class="nav-text">å­æŸ¥è¯¢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿æ¥Redis"><span class="nav-number">2.7.</span> <span class="nav-text">è¿æ¥Redis</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">AlexiXiang</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
